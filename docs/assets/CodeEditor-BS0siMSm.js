import{L as Fe}from"./Loading-Bb8i5b2_.js";import{d as xe,O as we,l as I,P as We,y as Se,Q as ne,o as A,g as te,w as l,m,b as n,n as d,i as t,a as X,B as oe,A as le,R as Je,T as _e,z as ye,U as be,V as Ke,W as Ge,L as Ee,X as He,Y as ae,Z as ie,$ as Ye,a0 as je,j as qe,s as Qe,x as Xe,a1 as Ze,a2 as c,S as E,a3 as he,a4 as et,H as Ve,G as D,a5 as tt,a6 as q,a7 as Q,p as ot,f as st,k as B,a8 as nt,q as lt,C as at,t as U,I as it,a9 as se,aa as rt,ab as ut,ac as Ce,K as dt,E as mt,ad as pt,M as ft,_ as vt}from"./index-D767YE15.js";import{E as gt}from"./el-checkbox-CezvXfsL.js";import{E as ct}from"./el-drawer-DakVXP-_.js";const _t={class:"orp"},yt={"w-full":""},Vt={class:"op-item"},Ct={key:0,class:"op-item"},kt={class:"op-item"},xt={key:1,class:"op-item"},wt={class:"op-item"},St={key:2,class:"op-item"},bt={class:"op-item"},Et={"w-full":""},Dt={class:"op-item"},At={class:"op-item"},Rt={"mt-1":"",flex:"","flex-row":"","flex-items-center":"","flex-justify-center":""},Tt=xe({__name:"OperationRecordPanel",setup(O){const{saveDialog:x,saveConfig:$,showCopyBtn:M}=He(),{openOperationRecordDrawer:R}=we(),z={merge_mouse_options:{merge:!0,max_interval_ms:300,merge_drag:!0},merge_key_options:{merge_repeat:!0,repeat_max_interval_ms:50,merge_press_release:!0,press_release_max_interval_ms:200},generateComment:!1,hiddenWindowBeforeRunning:!0},i=I(z),[F,V]=We("operation-capture-setting-form");Se(()=>{F.value&&(i.value=JSON.parse(JSON.stringify(F.value)))}),ne(i,()=>{V(i.value)},{deep:!0});const N=()=>{i.value=JSON.parse(JSON.stringify(z))},C=I(!1),Z=async()=>{C.value=!0;try{i.value.hiddenWindowBeforeRunning&&(Je.hide(),await _e.notify.sendCustom({name:"init",message:""}));const T=await ye.captureOperation(JSON.parse(JSON.stringify(i.value)),i.value.generateComment);await _e.notify.sendCustom({name:"stop",message:""}),$.name="操作记录",$.code=T,x.value=!0,M.value=!0}catch(T){console.error(T)}finally{C.value=!1}},h=()=>ye.stopCaptureOperation();return(T,s)=>{const p=be,w=Ke,W=Ge,L=Ee,r=ct;return A(),te(r,{modelValue:t(R),"onUpdate:modelValue":s[9]||(s[9]=a=>le(R)?R.value=a:null),title:"操作录制面板",direction:"rtl",size:"50%",class:"orp-drawer"},{default:l(()=>[m("div",_t,[m("div",yt,[m("div",Vt,[n(p,null,{default:l(()=>s[10]||(s[10]=[d("合并重复输入的按键")])),_:1}),n(w,{modelValue:t(i).merge_key_options.merge_repeat,"onUpdate:modelValue":s[0]||(s[0]=a=>t(i).merge_key_options.merge_repeat=a)},null,8,["modelValue"])]),t(i).merge_key_options.merge_repeat?(A(),X("div",Ct,[n(p,null,{default:l(()=>s[11]||(s[11]=[d("需要合并的重复按键按下时间最大间隔(ms)")])),_:1}),n(W,{style:{"margin-left":"10px"},modelValue:t(i).merge_key_options.repeat_max_interval_ms,"onUpdate:modelValue":s[1]||(s[1]=a=>t(i).merge_key_options.repeat_max_interval_ms=a),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",kt,[n(p,null,{default:l(()=>s[12]||(s[12]=[d("合并相同按键的按下和释放")])),_:1}),n(w,{modelValue:t(i).merge_key_options.merge_press_release,"onUpdate:modelValue":s[2]||(s[2]=a=>t(i).merge_key_options.merge_press_release=a)},null,8,["modelValue"])]),t(i).merge_key_options.merge_press_release?(A(),X("div",xt,[n(p,null,{default:l(()=>s[13]||(s[13]=[d("需要合并的按键按下与释放最大间隔(ms)")])),_:1}),n(W,{style:{"margin-left":"10px"},modelValue:t(i).merge_key_options.press_release_max_interval_ms,"onUpdate:modelValue":s[3]||(s[3]=a=>t(i).merge_key_options.press_release_max_interval_ms=a),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",wt,[n(p,null,{default:l(()=>s[14]||(s[14]=[d("合并相同鼠标按钮按下和释放")])),_:1}),n(w,{modelValue:t(i).merge_mouse_options.merge,"onUpdate:modelValue":s[4]||(s[4]=a=>t(i).merge_mouse_options.merge=a)},null,8,["modelValue"])]),t(i).merge_mouse_options.merge?(A(),X("div",St,[n(p,null,{default:l(()=>s[15]||(s[15]=[d("需要合并的鼠标按钮按下与释放最大间隔(ms)")])),_:1}),n(W,{style:{"margin-left":"10px"},modelValue:t(i).merge_mouse_options.max_interval_ms,"onUpdate:modelValue":s[5]||(s[5]=a=>t(i).merge_mouse_options.max_interval_ms=a),min:1,size:"small"},null,8,["modelValue"])])):oe("",!0),m("div",bt,[n(p,null,{default:l(()=>s[16]||(s[16]=[d("合并鼠标按下与释放时坐标不一致为拖拽")])),_:1}),n(w,{modelValue:t(i).merge_mouse_options.merge_drag,"onUpdate:modelValue":s[6]||(s[6]=a=>t(i).merge_mouse_options.merge_drag=a)},null,8,["modelValue"])])]),m("div",Et,[m("div",Dt,[n(p,null,{default:l(()=>s[17]||(s[17]=[d("生成注释")])),_:1}),n(w,{modelValue:t(i).generateComment,"onUpdate:modelValue":s[7]||(s[7]=a=>t(i).generateComment=a)},null,8,["modelValue"])]),m("div",At,[n(p,null,{default:l(()=>s[18]||(s[18]=[d("开始录制时隐藏本窗口")])),_:1}),n(w,{modelValue:t(i).hiddenWindowBeforeRunning,"onUpdate:modelValue":s[8]||(s[8]=a=>t(i).hiddenWindowBeforeRunning=a)},null,8,["modelValue"])]),m("div",Rt,[n(L,{onClick:N},{default:l(()=>s[19]||(s[19]=[d("重置选项")])),_:1}),t(C)?(A(),te(L,{key:1,type:"warning",onClick:h},{default:l(()=>s[21]||(s[21]=[d("停止录制")])),_:1})):(A(),te(L,{key:0,type:"primary",onClick:Z},{default:l(()=>s[20]||(s[20]=[d("开始录制")])),_:1}))])])])]),_:1},8,["modelValue"])}}}),Lt=(O,x)=>{O.addAction({id:"fastFillParams",label:"快速填写参数",keybindings:[ae.CtrlCmd|ie.Tab],contextMenuGroupId:"navigation",contextMenuOrder:0,run:x})},Pt=(O,x)=>{O.addAction({id:"insertSnippetCode",label:"插入代码片段",keybindings:[ae.chord(ae.CtrlCmd|ie.KeyK,ie.KeyI)],contextMenuGroupId:"navigation",contextMenuOrder:.1,run:x})},ke={auxiliaryActionRegister:Lt,insertSnippetCodeActionRegister:Pt},Ut={class:"script-editor-dev"},It={flex:"","flex-row":"","flex-items-center":""},Ot={class:"dialog-footer"},Nt={class:"dialog-footer"},Bt={class:"dialog-footer"},$t={class:"dialog-footer"},Mt={id:"codeEditBox"},zt={class:"loading"},Ft=xe({__name:"CodeEditor",setup(O){const x=Ye("snippetSearchRef"),$=it,M=je(),R=qe(),{scriptList:z}=Qe(R),{findEditor:i,editorInit:F,editorValue:V,insertText:N,setText:C,formatCode:Z,disposeEditor:h,registerEditorEvent:T,unRegisterEditorEvent:s}=we(),{openId:p,preloadText:w,preloadPath:W,isEditing:L,fileInfo:r,declareMod:a,saveMod:S}=st(),b=I(""),De=async()=>{const o=R.codeSnippets.find(e=>e.name===b.value);if(o){const e=await se.readFile(o.filePath);N(c,e.trim()),rt.success("代码片段插入成功")}P.value=!1},{invokeDynamicDialog:Ae}=ut(),_=Ce.getFnInfo(),{apiAutoTip:Re}=Ce,J=I(!0),K=o=>B().mockScriptList.value.find(v=>v.id===p.value)[o],re=I(),Te=o=>{o.preventDefault();const{deltaY:e}=o;re.value.scrollLeft+=e},G=Xe({visible:!1,cb:()=>{},close_cb:()=>{}}),Le=async()=>r.declare?(B().mockScriptList.value.find(o=>o.id===p.value).content=V.value,r.originData=V.value,D({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0):(D({title:"保存失败",message:"保存之前请先在脚本头部插入'脚本声明'或者将脚本声明补充完整",type:"error",position:"bottom-right"}),!1),Pe=async()=>{const o=await se.selectFile(!1);o&&(S.savePath=o,r.savePath=o)},Ue=async()=>{S.visible=!1;try{await se.writeFile(r.savePath,V.value),r.originData=V.value;const o=dt();return z.value.push({id:o,savePath:r.savePath,name:r.name,version:r.version,description:r.description,setting:{autoImportLastRunConfig:!1,targetAdbDevice:"",excludeDevice:[],targetApp:"",autoStartTargetApp:!1}}),p.value=o,D({title:"提示",message:"保存成功",type:"success",position:"bottom-right"}),!0}catch(o){return console.error(o),D({title:"保存失败",message:JSON.stringify(o),type:"error",position:"bottom-right"}),!1}},Ie=()=>{N(c,`/**
 * 请勿删除，此声明会在脚本读取时用到！
 * @version:${a.version}
 * @name:${a.name}
 * @description:${a.description}
 */`,!0),a.description="无",a.name="未命名脚本",a.version="v1.0",a.visible=!1},ue=o=>{if(o.key==="s"&&o.ctrlKey){Z();const v=setTimeout(()=>{Le(),clearTimeout(v)},200);o.preventDefault()}},P=I(!1),Oe=()=>{if(_.value){if(!_.value.haveAuxiliary){D({title:"提示",message:"当前函数无需填写参数或不支持快速填写参数。",type:"info",position:"bottom-right"});return}const o=e=>{N(c,e,!1,_.value.paramsRange)};Ae(_.value.name,_.value.name,_.value.content||"","changeArgs",o,_.value.params)}};let H=null;const de=()=>{Ve.currentRoute.value.name==="scriptEditor"&&(H&&clearTimeout(H),H=setTimeout(()=>{clearTimeout(H);const o=V.value;if(o.indexOf(" */")===-1)r.declare=!1;else{const e=o.indexOf(" */")+3,v=V.value.substring(0,e),f={name:"",version:"",description:""};if(v.replaceAll("/**","").replace(/ \* -{19}提示-{19}[\s\S]* \* -{42}/,"").replaceAll(`
 * `,"").replaceAll(`
 */`,"").trim().split("@").forEach(y=>{if(y!==""){const g=y.split(":");g[0]==="version"?f.version=g[1]:g[0]==="name"?f.name=g[1]:g[0]==="description"&&(f.description=g[1])}}),f.description===""||f.name===""||f.version==="")r.declare=!1;else{const y=B().mockScriptList,g=y.value.findIndex(ee=>ee.id===(p==null?void 0:p.value));(p==null?void 0:p.value)!=="-1"&&(y.value[g].version=f.version,y.value[g].name=f.name,y.value[g].description=f.description),r.declare=!0,r.version=f.version,r.name=f.name,r.description=f.description}}},500))};ne(V,()=>{de()});const Ne=o=>{Re(),r.lastData=V.value},me=()=>{var o;(o=i(c))==null||o.layout()},Be=async(o="init",e)=>{{const v=K("content");r.originData=v||"",r.name=K("name"),r.description=K("description"),C(c,r.originData);return}};Ze();const $e=(o,e)=>{const v=o?B().mockCodeSnippetList.value.filter(f=>f.name.toLowerCase().includes(b.value.toLowerCase())||f.description.toLowerCase().includes(b.value.toLowerCase())||f.prefix.toLowerCase().includes(b.value.toLowerCase())):B().mockCodeSnippetList.value;e(v)};Se(async()=>{var o;L.value=!0,J.value=!1,window.addEventListener("resize",me),F(c),await pe(),(o=document.getElementById(c))==null||o.addEventListener("keydown",ue),T("mounted",e=>{ke.auxiliaryActionRegister(e,Oe),ke.insertSnippetCodeActionRegister(e,()=>{P.value=!0,setTimeout(()=>{var f;(f=x.value)==null||f.focus()})}),e.onDidChangeCursorPosition(Ne),C(c,r.originData||E());const v=setTimeout(()=>{de(),J.value=!0,clearTimeout(v)},200)})}),he(()=>{var o;et.clearCache(),s("mounted"),window.removeEventListener("resize",me),(o=document.getElementById(c))==null||o.removeEventListener("keydown",ue),h(),L.value=!1});const pe=async()=>{const o=Ve.currentRoute.value.name;if(p.value!=="-1"&&o==="scriptEditor"){const e=K("savePath");if(e)try{Be("init",e)}catch(v){console.error(v),D({title:"提示",message:"文件读取失败，进入新增模式",type:"error",position:"bottom-right"}),r.originData=E(),r.savePath="",C(c,E());return}else r.originData=E(),r.savePath="",C(c,E()),D({title:"提示",message:"文件读取失败，路径为空，进入新增模式",type:"error",position:"bottom-right"})}else p.value==="-1"&&o==="scriptEditor"&&(r.originData=E(),r.savePath="",C(c,E()))};return ne(p,pe),tt(()=>{const o=w.value;nt(()=>{C(c,o)})}),(o,e)=>{var fe,ve,ge;const v=Tt,f=mt,y=lt,g=be,ee=pt,k=Ee,Y=at,j=ft,Me=gt,ze=Fe;return A(),X("div",Ut,[n(v),n(Y,{modelValue:t(P),"onUpdate:modelValue":e[2]||(e[2]=u=>le(P)?P.value=u:null),title:"插入代码片段",width:"60%"},{footer:l(()=>[m("span",Ot,[n(k,{onClick:e[1]||(e[1]=u=>P.value=!1)},{default:l(()=>e[14]||(e[14]=[d("取消")])),_:1}),n(k,{type:"primary",onClick:De},{default:l(()=>e[15]||(e[15]=[d(" 确定 ")])),_:1})])]),default:l(()=>[n(ee,{modelValue:t(b),"onUpdate:modelValue":e[0]||(e[0]=u=>le(b)?b.value=u:null),"value-key":"name","fetch-suggestions":$e,placeholder:"搜索代码片段:名称、备注、前缀",ref_key:"snippetSearchRef",ref:x},{suffix:l(()=>[n(f,null,{default:l(()=>e[13]||(e[13]=[m("span",{"i-mdi-text-search":""},null,-1)])),_:1})]),default:l(({item:u})=>[m("div",It,[n(y,{type:"primary",size:"small","mr-1":""},{default:l(()=>[d(U(u.prefix),1)]),_:2},1024),n(g,null,{default:l(()=>[d(U(u.name),1)]),_:2},1024)]),n(g,null,{default:l(()=>[d(U(u.description),1)]),_:2},1024)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),n(Y,{modelValue:t(a).visible,"onUpdate:modelValue":e[7]||(e[7]=u=>t(a).visible=u),title:"插入脚本声明"},{footer:l(()=>[m("span",Nt,[n(k,{onClick:e[6]||(e[6]=u=>t(a).visible=!1)},{default:l(()=>e[16]||(e[16]=[d("取消")])),_:1}),n(k,{type:"primary",onClick:Ie},{default:l(()=>e[17]||(e[17]=[d(" 确定 ")])),_:1})])]),default:l(()=>[e[18]||(e[18]=m("div",null,"脚本名称",-1)),n(j,{modelValue:t(a).name,"onUpdate:modelValue":e[3]||(e[3]=u=>t(a).name=u)},null,8,["modelValue"]),e[19]||(e[19]=m("div",null,"脚本版本",-1)),n(j,{modelValue:t(a).version,"onUpdate:modelValue":e[4]||(e[4]=u=>t(a).version=u)},null,8,["modelValue"]),e[20]||(e[20]=m("div",null,"脚本描述",-1)),n(j,{modelValue:t(a).description,"onUpdate:modelValue":e[5]||(e[5]=u=>t(a).description=u)},null,8,["modelValue"])]),_:1},8,["modelValue"]),n(Y,{modelValue:t(S).visible,"onUpdate:modelValue":e[10]||(e[10]=u=>t(S).visible=u),title:"保存脚本"},{footer:l(()=>[m("span",Bt,[n(k,{onClick:e[9]||(e[9]=u=>t(S).visible=!1)},{default:l(()=>e[22]||(e[22]=[d("取消")])),_:1}),n(k,{type:"primary",onClick:Ue},{default:l(()=>e[23]||(e[23]=[d(" 确定 ")])),_:1})])]),default:l(()=>[e[24]||(e[24]=m("div",null,"请选择脚本的保存路径",-1)),n(j,{modelValue:t(S).savePath,"onUpdate:modelValue":e[8]||(e[8]=u=>t(S).savePath=u)},{append:l(()=>[n(k,{type:"primary",onClick:Pe},{default:l(()=>e[21]||(e[21]=[d("选择")])),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),n(Y,{modelValue:t(G).visible,"onUpdate:modelValue":e[12]||(e[12]=u=>t(G).visible=u),title:"运行脚本"},{footer:l(()=>[m("span",$t,[n(k,{onClick:t(G).close_cb},{default:l(()=>e[25]||(e[25]=[d("直接运行")])),_:1},8,["onClick"]),n(k,{type:"primary",onClick:t(G).cb},{default:l(()=>e[26]||(e[26]=[d(" 保存后运行 ")])),_:1},8,["onClick"])])]),default:l(()=>[e[27]||(e[27]=m("div",null,"检测到当前脚本已做更改，若不保存则运行最后一次保存的内容",-1)),n(Me,{modelValue:t(M).editor.runAutoSave,"onUpdate:modelValue":e[11]||(e[11]=u=>t(M).editor.runAutoSave=u),label:"不再提醒,下次运行自动保存,可在设置页关闭自动保存",size:"large"},null,8,["modelValue"])]),_:1},8,["modelValue"]),q(m("div",Mt,null,512),[[Q,t(J)]]),q(m("div",zt,[n(ze),e[28]||(e[28]=m("div",null,"编辑器加载中...",-1))],512),[[Q,!t(J)]]),m("div",{class:"auto-api-tip scrollbar",onWheel:ot(Te,["stop"]),ref_key:"scrollbarRef",ref:re},[q(n(y,{style:{"margin-right":"3px"},size:"small",type:"success"},{default:l(()=>[d(U(t($)?"[鼠标右键]":"Ctrl+Tab ：")+"快速填写/修改参数 ",1)]),_:1},512),[[Q,(fe=t(_))==null?void 0:fe.haveAuxiliary]]),q(n(y,{size:"small",type:"info"},{default:l(()=>{var u,ce;return[d(U((u=t(_))==null?void 0:u.name)+":"+U((ce=t(_))==null?void 0:ce.content),1)]}),_:1},512),[[Q,((ve=t(_))==null?void 0:ve.name)&&((ge=t(_))==null?void 0:ge.content)]])],544)])}}}),Ht=vt(Ft,[["__scopeId","data-v-f9662bc7"]]);export{Ht as default};
