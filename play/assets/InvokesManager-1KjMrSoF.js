var Qe=Object.defineProperty;var Ze=(e,o,n)=>o in e?Qe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var te=(e,o,n)=>Ze(e,typeof o!="symbol"?o+"":o,n);import{be as hasOwn,x as reactive,ci as isObject,cj as isPropAbsent,al as _export_sfc,d as defineComponent,ah as useNamespace,ao as inject,bt as h,aj as renderSlot,ai as provide,l as ref,ck as removeClass,cl as addClass,cm as ElCollapseTransition,E as ElIcon,cn as loading_default,Q as watch,a8 as nextTick,co as caret_right_default,r as resolveComponent,a6 as withDirectives,a7 as vShow,o as openBlock,a as createElementBlock,m as createBaseVNode,g as createBlock,w as withCtx,h as resolveDynamicComponent,ak as normalizeClass,p as withModifiers,B as createCommentVNode,b as createVNode,ap as normalizeStyle,F as Fragment,D as renderList,am as getCurrentInstance,bs as isFunction,bc as isString,b7 as shallowRef,y as onMounted,cp as onUpdated,c0 as useEventListener,aZ as EVENT_CODE,an as iconPropType,aP as useLocale,cq as selectKey,c as computed,cr as formItemContextKey,t as toDisplayString,as as withInstall,cs as pick,ct as toRefs,ax as ElSelect,bb as UPDATE_MODEL_EVENT,aw as ElOption,aT as isEqual,cu as escapeStringRegexp,bd as isNil,aG as isEmpty,b6 as isClient,u as useCssVars,i as unref,e as useAppTheme,n as createTextVNode,q as ElTag,U as ElText,L as ElButton,N as ElButtonGroup,bB as __unplugin_components_6$1,cv as __unplugin_components_5,cw as __unplugin_components_7,V as ElSwitch,cx as __unplugin_components_10,W as ElInputNumber,M as ElInput,bA as _sfc_main$8,_ as _export_sfc$1,cy as mergeModels,cz as useModel,K as nanoid,A as isRef,j as useListStore,aa as ElMessage,cA as ElFormItem,cB as ElForm,cC as _sfc_main$9,cD as ElDivider,J as pathUtils,a9 as fsUtils,cE as exists,a4 as astWorker,a5 as watchEffect,a3 as onBeforeUnmount,cF as listen,bR as ElMessageBox,ad as ElAutocomplete,ab as useCore,bP as getCurrent,z as invokeBaseApi,bv as onUnmounted,R as appWindow}from"./index-D767YE15.js";import{E as ElEmpty}from"./el-empty-C55xF_EA.js";import{d as dataStructureUtils,E as ElTableColumn,a as ElTable,_ as __unplugin_components_14}from"./dataStructure-DJrLD1tV.js";/* empty css                        */import{l as lo}from"./vue-draggable-plus-B7hlTZXz.js";import{E as ElCheckbox}from"./el-checkbox-CezvXfsL.js";import{E as ElSegmented}from"./el-segmented-vz10XJfS.js";import"./isArrayLikeObject-CbXCMNMt.js";const NODE_KEY="$treeNodeId",markNodeData=function(e,o){!o||o[NODE_KEY]||Object.defineProperty(o,NODE_KEY,{value:e.id,enumerable:!1,configurable:!1,writable:!1})},getNodeKey=function(e,o){return e?o[e]:o[NODE_KEY]},handleCurrentChange=(e,o,n)=>{const l=e.value.currentNode;n();const r=e.value.currentNode;l!==r&&o("current-change",r?r.data:null,r)},getChildState=e=>{let o=!0,n=!0,l=!0;for(let r=0,a=e.length;r<a;r++){const c=e[r];(c.checked!==!0||c.indeterminate)&&(o=!1,c.disabled||(l=!1)),(c.checked!==!1||c.indeterminate)&&(n=!1)}return{all:o,none:n,allWithoutDisable:l,half:!o&&!n}},reInitChecked=function(e){if(e.childNodes.length===0||e.loading)return;const{all:o,none:n,half:l}=getChildState(e.childNodes);o?(e.checked=!0,e.indeterminate=!1):l?(e.checked=!1,e.indeterminate=!0):n&&(e.checked=!1,e.indeterminate=!1);const r=e.parent;!r||r.level===0||e.store.checkStrictly||reInitChecked(r)},getPropertyFromData=function(e,o){const n=e.store.props,l=e.data||{},r=n[o];if(typeof r=="function")return r(l,e);if(typeof r=="string")return l[r];if(typeof r>"u"){const a=l[o];return a===void 0?"":a}};let nodeIdSeed=0;class Node{constructor(o){this.id=nodeIdSeed++,this.text=null,this.checked=!1,this.indeterminate=!1,this.data=null,this.expanded=!1,this.parent=null,this.visible=!0,this.isCurrent=!1,this.canFocus=!1;for(const n in o)hasOwn(o,n)&&(this[n]=o[n]);this.level=0,this.loaded=!1,this.childNodes=[],this.loading=!1,this.parent&&(this.level=this.parent.level+1)}initialize(){const o=this.store;if(!o)throw new Error("[Node]store is required!");o.registerNode(this);const n=o.props;if(n&&typeof n.isLeaf<"u"){const a=getPropertyFromData(this,"isLeaf");typeof a=="boolean"&&(this.isLeafByUser=a)}if(o.lazy!==!0&&this.data?(this.setData(this.data),o.defaultExpandAll&&(this.expanded=!0,this.canFocus=!0)):this.level>0&&o.lazy&&o.defaultExpandAll&&!this.isLeafByUser&&this.expand(),Array.isArray(this.data)||markNodeData(this,this.data),!this.data)return;const l=o.defaultExpandedKeys,r=o.key;r&&l&&l.includes(this.key)&&this.expand(null,o.autoExpandParent),r&&o.currentNodeKey!==void 0&&this.key===o.currentNodeKey&&(o.currentNode=this,o.currentNode.isCurrent=!0),o.lazy&&o._initDefaultCheckedNode(this),this.updateLeafState(),this.parent&&(this.level===1||this.parent.expanded===!0)&&(this.canFocus=!0)}setData(o){Array.isArray(o)||markNodeData(this,o),this.data=o,this.childNodes=[];let n;this.level===0&&Array.isArray(this.data)?n=this.data:n=getPropertyFromData(this,"children")||[];for(let l=0,r=n.length;l<r;l++)this.insertChild({data:n[l]})}get label(){return getPropertyFromData(this,"label")}get key(){const o=this.store.key;return this.data?this.data[o]:null}get disabled(){return getPropertyFromData(this,"disabled")}get nextSibling(){const o=this.parent;if(o){const n=o.childNodes.indexOf(this);if(n>-1)return o.childNodes[n+1]}return null}get previousSibling(){const o=this.parent;if(o){const n=o.childNodes.indexOf(this);if(n>-1)return n>0?o.childNodes[n-1]:null}return null}contains(o,n=!0){return(this.childNodes||[]).some(l=>l===o||n&&l.contains(o))}remove(){const o=this.parent;o&&o.removeChild(this)}insertChild(o,n,l){if(!o)throw new Error("InsertChild error: child is required.");if(!(o instanceof Node)){if(!l){const r=this.getChildren(!0);r.includes(o.data)||(typeof n>"u"||n<0?r.push(o.data):r.splice(n,0,o.data))}Object.assign(o,{parent:this,store:this.store}),o=reactive(new Node(o)),o instanceof Node&&o.initialize()}o.level=this.level+1,typeof n>"u"||n<0?this.childNodes.push(o):this.childNodes.splice(n,0,o),this.updateLeafState()}insertBefore(o,n){let l;n&&(l=this.childNodes.indexOf(n)),this.insertChild(o,l)}insertAfter(o,n){let l;n&&(l=this.childNodes.indexOf(n),l!==-1&&(l+=1)),this.insertChild(o,l)}removeChild(o){const n=this.getChildren()||[],l=n.indexOf(o.data);l>-1&&n.splice(l,1);const r=this.childNodes.indexOf(o);r>-1&&(this.store&&this.store.deregisterNode(o),o.parent=null,this.childNodes.splice(r,1)),this.updateLeafState()}removeChildByData(o){let n=null;for(let l=0;l<this.childNodes.length;l++)if(this.childNodes[l].data===o){n=this.childNodes[l];break}n&&this.removeChild(n)}expand(o,n){const l=()=>{if(n){let r=this.parent;for(;r.level>0;)r.expanded=!0,r=r.parent}this.expanded=!0,o&&o(),this.childNodes.forEach(r=>{r.canFocus=!0})};this.shouldLoadData()?this.loadData(r=>{Array.isArray(r)&&(this.checked?this.setChecked(!0,!0):this.store.checkStrictly||reInitChecked(this),l())}):l()}doCreateChildren(o,n={}){o.forEach(l=>{this.insertChild(Object.assign({data:l},n),void 0,!0)})}collapse(){this.expanded=!1,this.childNodes.forEach(o=>{o.canFocus=!1})}shouldLoadData(){return this.store.lazy===!0&&this.store.load&&!this.loaded}updateLeafState(){if(this.store.lazy===!0&&this.loaded!==!0&&typeof this.isLeafByUser<"u"){this.isLeaf=this.isLeafByUser;return}const o=this.childNodes;if(!this.store.lazy||this.store.lazy===!0&&this.loaded===!0){this.isLeaf=!o||o.length===0;return}this.isLeaf=!1}setChecked(o,n,l,r){if(this.indeterminate=o==="half",this.checked=o===!0,this.store.checkStrictly)return;if(!(this.shouldLoadData()&&!this.store.checkDescendants)){const{all:c,allWithoutDisable:C}=getChildState(this.childNodes);!this.isLeaf&&!c&&C&&(this.checked=!1,o=!1);const p=()=>{if(n){const k=this.childNodes;for(let v=0,y=k.length;v<y;v++){const N=k[v];r=r||o!==!1;const V=N.disabled?N.checked:r;N.setChecked(V,n,!0,r)}const{half:u,all:x}=getChildState(k);x||(this.checked=x,this.indeterminate=u)}};if(this.shouldLoadData()){this.loadData(()=>{p(),reInitChecked(this)},{checked:o!==!1});return}else p()}const a=this.parent;!a||a.level===0||l||reInitChecked(a)}getChildren(o=!1){if(this.level===0)return this.data;const n=this.data;if(!n)return null;const l=this.store.props;let r="children";return l&&(r=l.children||"children"),n[r]===void 0&&(n[r]=null),o&&!n[r]&&(n[r]=[]),n[r]}updateChildren(){const o=this.getChildren()||[],n=this.childNodes.map(a=>a.data),l={},r=[];o.forEach((a,c)=>{const C=a[NODE_KEY];!!C&&n.findIndex(k=>k[NODE_KEY]===C)>=0?l[C]={index:c,data:a}:r.push({index:c,data:a})}),this.store.lazy||n.forEach(a=>{l[a[NODE_KEY]]||this.removeChildByData(a)}),r.forEach(({index:a,data:c})=>{this.insertChild({data:c},a)}),this.updateLeafState()}loadData(o,n={}){if(this.store.lazy===!0&&this.store.load&&!this.loaded&&(!this.loading||Object.keys(n).length)){this.loading=!0;const l=a=>{this.childNodes=[],this.doCreateChildren(a,n),this.loaded=!0,this.loading=!1,this.updateLeafState(),o&&o.call(this,a)},r=()=>{this.loading=!1};this.store.load(this,l,r)}else o&&o.call(this)}eachNode(o){const n=[this];for(;n.length;){const l=n.shift();n.unshift(...l.childNodes),o(l)}}reInitChecked(){this.store.checkStrictly||reInitChecked(this)}}class TreeStore{constructor(o){this.currentNode=null,this.currentNodeKey=null;for(const n in o)hasOwn(o,n)&&(this[n]=o[n]);this.nodesMap={}}initialize(){if(this.root=new Node({data:this.data,store:this}),this.root.initialize(),this.lazy&&this.load){const o=this.load;o(this.root,n=>{this.root.doCreateChildren(n),this._initDefaultCheckedNodes()})}else this._initDefaultCheckedNodes()}filter(o){const n=this.filterNodeMethod,l=this.lazy,r=function(a){const c=a.root?a.root.childNodes:a.childNodes;if(c.forEach(C=>{C.visible=n.call(C,o,C.data,C),r(C)}),!a.visible&&c.length){let C=!0;C=!c.some(p=>p.visible),a.root?a.root.visible=C===!1:a.visible=C===!1}o&&a.visible&&!a.isLeaf&&(!l||a.loaded)&&a.expand()};r(this)}setData(o){o!==this.root.data?(this.nodesMap={},this.root.setData(o),this._initDefaultCheckedNodes()):this.root.updateChildren()}getNode(o){if(o instanceof Node)return o;const n=isObject(o)?getNodeKey(this.key,o):o;return this.nodesMap[n]||null}insertBefore(o,n){const l=this.getNode(n);l.parent.insertBefore({data:o},l)}insertAfter(o,n){const l=this.getNode(n);l.parent.insertAfter({data:o},l)}remove(o){const n=this.getNode(o);n&&n.parent&&(n===this.currentNode&&(this.currentNode=null),n.parent.removeChild(n))}append(o,n){const l=isPropAbsent(n)?this.root:this.getNode(n);l&&l.insertChild({data:o})}_initDefaultCheckedNodes(){const o=this.defaultCheckedKeys||[],n=this.nodesMap;o.forEach(l=>{const r=n[l];r&&r.setChecked(!0,!this.checkStrictly)})}_initDefaultCheckedNode(o){(this.defaultCheckedKeys||[]).includes(o.key)&&o.setChecked(!0,!this.checkStrictly)}setDefaultCheckedKey(o){o!==this.defaultCheckedKeys&&(this.defaultCheckedKeys=o,this._initDefaultCheckedNodes())}registerNode(o){const n=this.key;!o||!o.data||(n?o.key!==void 0&&(this.nodesMap[o.key]=o):this.nodesMap[o.id]=o)}deregisterNode(o){!this.key||!o||!o.data||(o.childNodes.forEach(l=>{this.deregisterNode(l)}),delete this.nodesMap[o.key])}getCheckedNodes(o=!1,n=!1){const l=[],r=function(a){(a.root?a.root.childNodes:a.childNodes).forEach(C=>{(C.checked||n&&C.indeterminate)&&(!o||o&&C.isLeaf)&&l.push(C.data),r(C)})};return r(this),l}getCheckedKeys(o=!1){return this.getCheckedNodes(o).map(n=>(n||{})[this.key])}getHalfCheckedNodes(){const o=[],n=function(l){(l.root?l.root.childNodes:l.childNodes).forEach(a=>{a.indeterminate&&o.push(a.data),n(a)})};return n(this),o}getHalfCheckedKeys(){return this.getHalfCheckedNodes().map(o=>(o||{})[this.key])}_getAllNodes(){const o=[],n=this.nodesMap;for(const l in n)hasOwn(n,l)&&o.push(n[l]);return o}updateChildren(o,n){const l=this.nodesMap[o];if(!l)return;const r=l.childNodes;for(let a=r.length-1;a>=0;a--){const c=r[a];this.remove(c.data)}for(let a=0,c=n.length;a<c;a++){const C=n[a];this.append(C,l.data)}}_setCheckedKeys(o,n=!1,l){const r=this._getAllNodes().sort((p,k)=>p.level-k.level),a=Object.create(null),c=Object.keys(l);r.forEach(p=>p.setChecked(!1,!1));const C=p=>{p.childNodes.forEach(k=>{var u;a[k.data[o]]=!0,(u=k.childNodes)!=null&&u.length&&C(k)})};for(let p=0,k=r.length;p<k;p++){const u=r[p],x=u.data[o].toString();if(!c.includes(x)){u.checked&&!a[x]&&u.setChecked(!1,!1);continue}if(u.childNodes.length&&C(u),u.isLeaf||this.checkStrictly){u.setChecked(!0,!1);continue}if(u.setChecked(!0,!0),n){u.setChecked(!1,!1);const y=function(N){N.childNodes.forEach(s=>{s.isLeaf||s.setChecked(!1,!1),y(s)})};y(u)}}}setCheckedNodes(o,n=!1){const l=this.key,r={};o.forEach(a=>{r[(a||{})[l]]=!0}),this._setCheckedKeys(l,n,r)}setCheckedKeys(o,n=!1){this.defaultCheckedKeys=o;const l=this.key,r={};o.forEach(a=>{r[a]=!0}),this._setCheckedKeys(l,n,r)}setDefaultExpandedKeys(o){o=o||[],this.defaultExpandedKeys=o,o.forEach(n=>{const l=this.getNode(n);l&&l.expand(null,this.autoExpandParent)})}setChecked(o,n,l){const r=this.getNode(o);r&&r.setChecked(!!n,l)}getCurrentNode(){return this.currentNode}setCurrentNode(o){const n=this.currentNode;n&&(n.isCurrent=!1),this.currentNode=o,this.currentNode.isCurrent=!0}setUserCurrentNode(o,n=!0){const l=o[this.key],r=this.nodesMap[l];this.setCurrentNode(r),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0)}setCurrentNodeKey(o,n=!0){if(o==null){this.currentNode&&(this.currentNode.isCurrent=!1),this.currentNode=null;return}const l=this.getNode(o);l&&(this.setCurrentNode(l),n&&this.currentNode.level>1&&this.currentNode.parent.expand(null,!0))}}const _sfc_main$7=defineComponent({name:"ElTreeNodeContent",props:{node:{type:Object,required:!0},renderContent:Function},setup(e){const o=useNamespace("tree"),n=inject("NodeInstance"),l=inject("RootTree");return()=>{const r=e.node,{data:a,store:c}=r;return e.renderContent?e.renderContent(h,{_self:n,node:r,data:a,store:c}):renderSlot(l.ctx.slots,"default",{node:r,data:a},()=>[h("span",{class:o.be("node","label")},[r.label])])}}});var NodeContent=_export_sfc(_sfc_main$7,[["__file","tree-node-content.vue"]]);function useNodeExpandEventBroadcast(e){const o=inject("TreeNodeMap",null),n={treeNodeExpand:l=>{e.node!==l&&e.node.collapse()},children:[]};return o&&o.children.push(n),provide("TreeNodeMap",n),{broadcastExpanded:l=>{if(e.accordion)for(const r of n.children)r.treeNodeExpand(l)}}}const dragEventsKey=Symbol("dragEvents");function useDragNodeHandler({props:e,ctx:o,el$:n,dropIndicator$:l,store:r}){const a=useNamespace("tree"),c=ref({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null});return provide(dragEventsKey,{treeNodeDragStart:({event:u,treeNode:x})=>{if(typeof e.allowDrag=="function"&&!e.allowDrag(x.node))return u.preventDefault(),!1;u.dataTransfer.effectAllowed="move";try{u.dataTransfer.setData("text/plain","")}catch{}c.value.draggingNode=x,o.emit("node-drag-start",x.node,u)},treeNodeDragOver:({event:u,treeNode:x})=>{const v=x,y=c.value.dropNode;y&&y.node.id!==v.node.id&&removeClass(y.$el,a.is("drop-inner"));const N=c.value.draggingNode;if(!N||!v)return;let V=!0,s=!0,A=!0,S=!0;typeof e.allowDrop=="function"&&(V=e.allowDrop(N.node,v.node,"prev"),S=s=e.allowDrop(N.node,v.node,"inner"),A=e.allowDrop(N.node,v.node,"next")),u.dataTransfer.dropEffect=s||V||A?"move":"none",(V||s||A)&&(y==null?void 0:y.node.id)!==v.node.id&&(y&&o.emit("node-drag-leave",N.node,y.node,u),o.emit("node-drag-enter",N.node,v.node,u)),V||s||A?c.value.dropNode=v:c.value.dropNode=null,v.node.nextSibling===N.node&&(A=!1),v.node.previousSibling===N.node&&(V=!1),v.node.contains(N.node,!1)&&(s=!1),(N.node===v.node||N.node.contains(v.node))&&(V=!1,s=!1,A=!1);const z=v.$el.querySelector(`.${a.be("node","content")}`).getBoundingClientRect(),I=n.value.getBoundingClientRect();let L;const q=V?s?.25:A?.45:1:-1,j=A?s?.75:V?.55:0:1;let b=-9999;const i=u.clientY-z.top;i<z.height*q?L="before":i>z.height*j?L="after":s?L="inner":L="none";const m=v.$el.querySelector(`.${a.be("node","expand-icon")}`).getBoundingClientRect(),F=l.value;L==="before"?b=m.top-I.top:L==="after"&&(b=m.bottom-I.top),F.style.top=`${b}px`,F.style.left=`${m.right-I.left}px`,L==="inner"?addClass(v.$el,a.is("drop-inner")):removeClass(v.$el,a.is("drop-inner")),c.value.showDropIndicator=L==="before"||L==="after",c.value.allowDrop=c.value.showDropIndicator||S,c.value.dropType=L,o.emit("node-drag-over",N.node,v.node,u)},treeNodeDragEnd:u=>{const{draggingNode:x,dropType:v,dropNode:y}=c.value;if(u.preventDefault(),u.dataTransfer&&(u.dataTransfer.dropEffect="move"),x&&y){const N={data:x.node.data};v!=="none"&&x.node.remove(),v==="before"?y.node.parent.insertBefore(N,y.node):v==="after"?y.node.parent.insertAfter(N,y.node):v==="inner"&&y.node.insertChild(N),v!=="none"&&(r.value.registerNode(N),r.value.key&&x.node.eachNode(V=>{var s;(s=r.value.nodesMap[V.data[r.value.key]])==null||s.setChecked(V.checked,!r.value.checkStrictly)})),removeClass(y.$el,a.is("drop-inner")),o.emit("node-drag-end",x.node,y.node,v,u),v!=="none"&&o.emit("node-drop",x.node,y.node,v,u)}x&&!y&&o.emit("node-drag-end",x.node,null,v,u),c.value.showDropIndicator=!1,c.value.draggingNode=null,c.value.dropNode=null,c.value.allowDrop=!0}}),{dragState:c}}const _sfc_main$6=defineComponent({name:"ElTreeNode",components:{ElCollapseTransition,ElCheckbox,NodeContent,ElIcon,Loading:loading_default},props:{node:{type:Node,default:()=>({})},props:{type:Object,default:()=>({})},accordion:Boolean,renderContent:Function,renderAfterExpand:Boolean,showCheckbox:{type:Boolean,default:!1}},emits:["node-expand"],setup(e,o){const n=useNamespace("tree"),{broadcastExpanded:l}=useNodeExpandEventBroadcast(e),r=inject("RootTree"),a=ref(!1),c=ref(!1),C=ref(null),p=ref(null),k=ref(null),u=inject(dragEventsKey),x=getCurrentInstance();provide("NodeInstance",x),e.node.expanded&&(a.value=!0,c.value=!0);const v=r.props.props.children||"children";watch(()=>{const i=e.node.data[v];return i&&[...i]},()=>{e.node.updateChildren()}),watch(()=>e.node.indeterminate,i=>{V(e.node.checked,i)}),watch(()=>e.node.checked,i=>{V(i,e.node.indeterminate)}),watch(()=>e.node.childNodes.length,()=>e.node.reInitChecked()),watch(()=>e.node.expanded,i=>{nextTick(()=>a.value=i),i&&(c.value=!0)});const y=i=>getNodeKey(r.props.nodeKey,i.data),N=i=>{const m=e.props.class;if(!m)return{};let F;if(isFunction(m)){const{data:U}=i;F=m(U,i)}else F=m;return isString(F)?{[F]:!0}:F},V=(i,m)=>{(C.value!==i||p.value!==m)&&r.ctx.emit("check-change",e.node.data,i,m),C.value=i,p.value=m},s=i=>{handleCurrentChange(r.store,r.ctx.emit,()=>r.store.value.setCurrentNode(e.node)),r.currentNode.value=e.node,r.props.expandOnClickNode&&S(),r.props.checkOnClickNode&&!e.node.disabled&&z(null,{target:{checked:!e.node.checked}}),r.ctx.emit("node-click",e.node.data,e.node,x,i)},A=i=>{r.instance.vnode.props.onNodeContextmenu&&(i.stopPropagation(),i.preventDefault()),r.ctx.emit("node-contextmenu",i,e.node.data,e.node,x)},S=()=>{e.node.isLeaf||(a.value?(r.ctx.emit("node-collapse",e.node.data,e.node,x),e.node.collapse()):e.node.expand(()=>{o.emit("node-expand",e.node.data,e.node,x)}))},z=(i,m)=>{e.node.setChecked(m.target.checked,!r.props.checkStrictly),nextTick(()=>{const F=r.store.value;r.ctx.emit("check",e.node.data,{checkedNodes:F.getCheckedNodes(),checkedKeys:F.getCheckedKeys(),halfCheckedNodes:F.getHalfCheckedNodes(),halfCheckedKeys:F.getHalfCheckedKeys()})})};return{ns:n,node$:k,tree:r,expanded:a,childNodeRendered:c,oldChecked:C,oldIndeterminate:p,getNodeKey:y,getNodeClass:N,handleSelectChange:V,handleClick:s,handleContextMenu:A,handleExpandIconClick:S,handleCheckChange:z,handleChildNodeExpand:(i,m,F)=>{l(m),r.ctx.emit("node-expand",i,m,F)},handleDragStart:i=>{r.props.draggable&&u.treeNodeDragStart({event:i,treeNode:e})},handleDragOver:i=>{i.preventDefault(),r.props.draggable&&u.treeNodeDragOver({event:i,treeNode:{$el:k.value,node:e.node}})},handleDrop:i=>{i.preventDefault()},handleDragEnd:i=>{r.props.draggable&&u.treeNodeDragEnd(i)},CaretRight:caret_right_default}}});function _sfc_render$1(e,o,n,l,r,a){const c=resolveComponent("el-icon"),C=resolveComponent("el-checkbox"),p=resolveComponent("loading"),k=resolveComponent("node-content"),u=resolveComponent("el-tree-node"),x=resolveComponent("el-collapse-transition");return withDirectives((openBlock(),createElementBlock("div",{ref:"node$",class:normalizeClass([e.ns.b("node"),e.ns.is("expanded",e.expanded),e.ns.is("current",e.node.isCurrent),e.ns.is("hidden",!e.node.visible),e.ns.is("focusable",!e.node.disabled),e.ns.is("checked",!e.node.disabled&&e.node.checked),e.getNodeClass(e.node)]),role:"treeitem",tabindex:"-1","aria-expanded":e.expanded,"aria-disabled":e.node.disabled,"aria-checked":e.node.checked,draggable:e.tree.props.draggable,"data-key":e.getNodeKey(e.node),onClick:withModifiers(e.handleClick,["stop"]),onContextmenu:e.handleContextMenu,onDragstart:withModifiers(e.handleDragStart,["stop"]),onDragover:withModifiers(e.handleDragOver,["stop"]),onDragend:withModifiers(e.handleDragEnd,["stop"]),onDrop:withModifiers(e.handleDrop,["stop"])},[createBaseVNode("div",{class:normalizeClass(e.ns.be("node","content")),style:normalizeStyle({paddingLeft:(e.node.level-1)*e.tree.props.indent+"px"})},[e.tree.props.icon||e.CaretRight?(openBlock(),createBlock(c,{key:0,class:normalizeClass([e.ns.be("node","expand-icon"),e.ns.is("leaf",e.node.isLeaf),{expanded:!e.node.isLeaf&&e.expanded}]),onClick:withModifiers(e.handleExpandIconClick,["stop"])},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.tree.props.icon||e.CaretRight)))]),_:1},8,["class","onClick"])):createCommentVNode("v-if",!0),e.showCheckbox?(openBlock(),createBlock(C,{key:1,"model-value":e.node.checked,indeterminate:e.node.indeterminate,disabled:!!e.node.disabled,onClick:withModifiers(()=>{},["stop"]),onChange:e.handleCheckChange},null,8,["model-value","indeterminate","disabled","onClick","onChange"])):createCommentVNode("v-if",!0),e.node.loading?(openBlock(),createBlock(c,{key:2,class:normalizeClass([e.ns.be("node","loading-icon"),e.ns.is("loading")])},{default:withCtx(()=>[createVNode(p)]),_:1},8,["class"])):createCommentVNode("v-if",!0),createVNode(k,{node:e.node,"render-content":e.renderContent},null,8,["node","render-content"])],6),createVNode(x,null,{default:withCtx(()=>[!e.renderAfterExpand||e.childNodeRendered?withDirectives((openBlock(),createElementBlock("div",{key:0,class:normalizeClass(e.ns.be("node","children")),role:"group","aria-expanded":e.expanded},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.node.childNodes,v=>(openBlock(),createBlock(u,{key:e.getNodeKey(v),"render-content":e.renderContent,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,node:v,accordion:e.accordion,props:e.props,onNodeExpand:e.handleChildNodeExpand},null,8,["render-content","render-after-expand","show-checkbox","node","accordion","props","onNodeExpand"]))),128))],10,["aria-expanded"])),[[vShow,e.expanded]]):createCommentVNode("v-if",!0)]),_:1})],42,["aria-expanded","aria-disabled","aria-checked","draggable","data-key","onClick","onContextmenu","onDragstart","onDragover","onDragend","onDrop"])),[[vShow,e.node.visible]])}var ElTreeNode=_export_sfc(_sfc_main$6,[["render",_sfc_render$1],["__file","tree-node.vue"]]);function useKeydown({el$:e},o){const n=useNamespace("tree"),l=shallowRef([]),r=shallowRef([]);onMounted(()=>{c()}),onUpdated(()=>{l.value=Array.from(e.value.querySelectorAll("[role=treeitem]")),r.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"))}),watch(r,C=>{C.forEach(p=>{p.setAttribute("tabindex","-1")})}),useEventListener(e,"keydown",C=>{const p=C.target;if(!p.className.includes(n.b("node")))return;const k=C.code;l.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`));const u=l.value.indexOf(p);let x;if([EVENT_CODE.up,EVENT_CODE.down].includes(k)){if(C.preventDefault(),k===EVENT_CODE.up){x=u===-1?0:u!==0?u-1:l.value.length-1;const y=x;for(;!o.value.getNode(l.value[x].dataset.key).canFocus;){if(x--,x===y){x=-1;break}x<0&&(x=l.value.length-1)}}else{x=u===-1?0:u<l.value.length-1?u+1:0;const y=x;for(;!o.value.getNode(l.value[x].dataset.key).canFocus;){if(x++,x===y){x=-1;break}x>=l.value.length&&(x=0)}}x!==-1&&l.value[x].focus()}[EVENT_CODE.left,EVENT_CODE.right].includes(k)&&(C.preventDefault(),p.click());const v=p.querySelector('[type="checkbox"]');[EVENT_CODE.enter,EVENT_CODE.space].includes(k)&&v&&(C.preventDefault(),v.click())});const c=()=>{var C;l.value=Array.from(e.value.querySelectorAll(`.${n.is("focusable")}[role=treeitem]`)),r.value=Array.from(e.value.querySelectorAll("input[type=checkbox]"));const p=e.value.querySelectorAll(`.${n.is("checked")}[role=treeitem]`);if(p.length){p[0].setAttribute("tabindex","0");return}(C=l.value[0])==null||C.setAttribute("tabindex","0")}}const _sfc_main$5=defineComponent({name:"ElTree",components:{ElTreeNode},props:{data:{type:Array,default:()=>[]},emptyText:{type:String},renderAfterExpand:{type:Boolean,default:!0},nodeKey:String,checkStrictly:Boolean,defaultExpandAll:Boolean,expandOnClickNode:{type:Boolean,default:!0},checkOnClickNode:Boolean,checkDescendants:{type:Boolean,default:!1},autoExpandParent:{type:Boolean,default:!0},defaultCheckedKeys:Array,defaultExpandedKeys:Array,currentNodeKey:[String,Number],renderContent:Function,showCheckbox:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},allowDrag:Function,allowDrop:Function,props:{type:Object,default:()=>({children:"children",label:"label",disabled:"disabled"})},lazy:{type:Boolean,default:!1},highlightCurrent:Boolean,load:Function,filterNodeMethod:Function,accordion:Boolean,indent:{type:Number,default:18},icon:{type:iconPropType}},emits:["check-change","current-change","node-click","node-contextmenu","node-collapse","node-expand","check","node-drag-start","node-drag-end","node-drop","node-drag-leave","node-drag-enter","node-drag-over"],setup(e,o){const{t:n}=useLocale(),l=useNamespace("tree"),r=inject(selectKey,null),a=ref(new TreeStore({key:e.nodeKey,data:e.data,lazy:e.lazy,props:e.props,load:e.load,currentNodeKey:e.currentNodeKey,checkStrictly:e.checkStrictly,checkDescendants:e.checkDescendants,defaultCheckedKeys:e.defaultCheckedKeys,defaultExpandedKeys:e.defaultExpandedKeys,autoExpandParent:e.autoExpandParent,defaultExpandAll:e.defaultExpandAll,filterNodeMethod:e.filterNodeMethod}));a.value.initialize();const c=ref(a.value.root),C=ref(null),p=ref(null),k=ref(null),{broadcastExpanded:u}=useNodeExpandEventBroadcast(e),{dragState:x}=useDragNodeHandler({props:e,ctx:o,el$:p,dropIndicator$:k,store:a});useKeydown({el$:p},a);const v=computed(()=>{const{childNodes:D}=c.value,f=r?r.hasFilteredOptions!==0:!1;return(!D||D.length===0||D.every(({visible:w})=>!w))&&!f});watch(()=>e.currentNodeKey,D=>{a.value.setCurrentNodeKey(D)}),watch(()=>e.defaultCheckedKeys,D=>{a.value.setDefaultCheckedKey(D)}),watch(()=>e.defaultExpandedKeys,D=>{a.value.setDefaultExpandedKeys(D)}),watch(()=>e.data,D=>{a.value.setData(D)},{deep:!0}),watch(()=>e.checkStrictly,D=>{a.value.checkStrictly=D});const y=D=>{if(!e.filterNodeMethod)throw new Error("[Tree] filterNodeMethod is required when filter");a.value.filter(D)},N=D=>getNodeKey(e.nodeKey,D.data),V=D=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getNodePath");const f=a.value.getNode(D);if(!f)return[];const w=[f.data];let $=f.parent;for(;$&&$!==c.value;)w.push($.data),$=$.parent;return w.reverse()},s=(D,f)=>a.value.getCheckedNodes(D,f),A=D=>a.value.getCheckedKeys(D),S=()=>{const D=a.value.getCurrentNode();return D?D.data:null},z=()=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in getCurrentKey");const D=S();return D?D[e.nodeKey]:null},I=(D,f)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedNodes");a.value.setCheckedNodes(D,f)},L=(D,f)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCheckedKeys");a.value.setCheckedKeys(D,f)},q=(D,f,w)=>{a.value.setChecked(D,f,w)},j=()=>a.value.getHalfCheckedNodes(),b=()=>a.value.getHalfCheckedKeys(),i=(D,f=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentNode");handleCurrentChange(a,o.emit,()=>{u(D),a.value.setUserCurrentNode(D,f)})},m=(D,f=!0)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in setCurrentKey");handleCurrentChange(a,o.emit,()=>{u(),a.value.setCurrentNodeKey(D,f)})},F=D=>a.value.getNode(D),U=D=>{a.value.remove(D)},B=(D,f)=>{a.value.append(D,f)},H=(D,f)=>{a.value.insertBefore(D,f)},K=(D,f)=>{a.value.insertAfter(D,f)},W=(D,f,w)=>{u(f),o.emit("node-expand",D,f,w)},J=(D,f)=>{if(!e.nodeKey)throw new Error("[Tree] nodeKey is required in updateKeyChild");a.value.updateChildren(D,f)};return provide("RootTree",{ctx:o,props:e,store:a,root:c,currentNode:C,instance:getCurrentInstance()}),provide(formItemContextKey,void 0),{ns:l,store:a,root:c,currentNode:C,dragState:x,el$:p,dropIndicator$:k,isEmpty:v,filter:y,getNodeKey:N,getNodePath:V,getCheckedNodes:s,getCheckedKeys:A,getCurrentNode:S,getCurrentKey:z,setCheckedNodes:I,setCheckedKeys:L,setChecked:q,getHalfCheckedNodes:j,getHalfCheckedKeys:b,setCurrentNode:i,setCurrentKey:m,t:n,getNode:F,remove:U,append:B,insertBefore:H,insertAfter:K,handleNodeExpand:W,updateKeyChildren:J}}});function _sfc_render(e,o,n,l,r,a){const c=resolveComponent("el-tree-node");return openBlock(),createElementBlock("div",{ref:"el$",class:normalizeClass([e.ns.b(),e.ns.is("dragging",!!e.dragState.draggingNode),e.ns.is("drop-not-allow",!e.dragState.allowDrop),e.ns.is("drop-inner",e.dragState.dropType==="inner"),{[e.ns.m("highlight-current")]:e.highlightCurrent}]),role:"tree"},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.root.childNodes,C=>(openBlock(),createBlock(c,{key:e.getNodeKey(C),node:C,props:e.props,accordion:e.accordion,"render-after-expand":e.renderAfterExpand,"show-checkbox":e.showCheckbox,"render-content":e.renderContent,onNodeExpand:e.handleNodeExpand},null,8,["node","props","accordion","render-after-expand","show-checkbox","render-content","onNodeExpand"]))),128)),e.isEmpty?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(e.ns.e("empty-block"))},[renderSlot(e.$slots,"empty",{},()=>{var C;return[createBaseVNode("span",{class:normalizeClass(e.ns.e("empty-text"))},toDisplayString((C=e.emptyText)!=null?C:e.t("el.tree.emptyText")),3)]})],2)):createCommentVNode("v-if",!0),withDirectives(createBaseVNode("div",{ref:"dropIndicator$",class:normalizeClass(e.ns.e("drop-indicator"))},null,2),[[vShow,e.dragState.showDropIndicator]])],2)}var Tree=_export_sfc(_sfc_main$5,[["render",_sfc_render],["__file","tree.vue"]]);const ElTree=withInstall(Tree),useSelect=(e,{attrs:o,emit:n},{select:l,tree:r,key:a})=>{const c=useNamespace("tree-select");return watch(()=>e.data,()=>{e.filterable&&nextTick(()=>{var p,k;(k=r.value)==null||k.filter((p=l.value)==null?void 0:p.states.inputValue)})},{flush:"post"}),{...pick(toRefs(e),Object.keys(ElSelect.props)),...o,"onUpdate:modelValue":p=>n(UPDATE_MODEL_EVENT,p),valueKey:a,popperClass:computed(()=>{const p=[c.e("popper")];return e.popperClass&&p.push(e.popperClass),p.join(" ")}),filterMethod:(p="")=>{var k;e.filterMethod?e.filterMethod(p):e.remoteMethod?e.remoteMethod(p):(k=r.value)==null||k.filter(p)}}},component=defineComponent({extends:ElOption,setup(e,o){const n=ElOption.setup(e,o);delete n.selectOptionClick;const l=getCurrentInstance().proxy;return nextTick(()=>{n.select.states.cachedOptions.get(l.value)||n.select.onOptionCreate(l)}),watch(()=>o.attrs.visible,r=>{n.states.visible=r},{immediate:!0}),n},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function isValidValue(e){return e||e===0}function isValidArray(e){return Array.isArray(e)&&e.length}function toValidArray(e){return Array.isArray(e)?e:isValidValue(e)?[e]:[]}function treeFind(e,o,n,l,r){for(let a=0;a<e.length;a++){const c=e[a];if(o(c,a,e,r))return l?l(c,a,e,r):c;{const C=n(c);if(isValidArray(C)){const p=treeFind(C,o,n,l,c);if(p)return p}}}}function treeEach(e,o,n,l){for(let r=0;r<e.length;r++){const a=e[r];o(a,r,e,l);const c=n(a);isValidArray(c)&&treeEach(c,o,n,a)}}const useTree=(e,{attrs:o,slots:n,emit:l},{select:r,tree:a,key:c})=>{watch(()=>e.modelValue,()=>{e.showCheckbox&&nextTick(()=>{const v=a.value;v&&!isEqual(v.getCheckedKeys(),toValidArray(e.modelValue))&&v.setCheckedKeys(toValidArray(e.modelValue))})},{immediate:!0,deep:!0});const C=computed(()=>({value:c.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),p=(v,y)=>{var N;const V=C.value[v];return isFunction(V)?V(y,(N=a.value)==null?void 0:N.getNode(p("value",y))):y[V]},k=toValidArray(e.modelValue).map(v=>treeFind(e.data||[],y=>p("value",y)===v,y=>p("children",y),(y,N,V,s)=>s&&p("value",s))).filter(v=>isValidValue(v)),u=computed(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const v=[];return treeEach(e.data.concat(e.cacheData),y=>{const N=p("value",y);v.push({value:N,currentLabel:p("label",y),isDisabled:p("disabled",y)})},y=>p("children",y)),v}),x=()=>{var v;return(v=a.value)==null?void 0:v.getCheckedKeys().filter(y=>{var N;const V=(N=a.value)==null?void 0:N.getNode(y);return!isNil(V)&&isEmpty(V.childNodes)})};return{...pick(toRefs(e),Object.keys(ElTree.props)),...o,nodeKey:c,expandOnClickNode:computed(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:computed(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(k):k),renderContent:(v,{node:y,data:N,store:V})=>v(component,{value:p("value",N),label:p("label",N),disabled:p("disabled",N),visible:y.visible},e.renderContent?()=>e.renderContent(v,{node:y,data:N,store:V}):n.default?()=>n.default({node:y,data:N,store:V}):void 0),filterNodeMethod:(v,y,N)=>e.filterNodeMethod?e.filterNodeMethod(v,y,N):v?new RegExp(escapeStringRegexp(v),"i").test(p("label",y)||""):!0,onNodeClick:(v,y,N)=>{var V,s,A,S;if((V=o.onNodeClick)==null||V.call(o,v,y,N),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||y.isLeaf)){if(!p("disabled",v)){const z=(s=r.value)==null?void 0:s.states.options.get(p("value",v));(A=r.value)==null||A.handleOptionSelect(z)}}else e.expandOnClickNode&&N.proxy.handleExpandIconClick();(S=r.value)==null||S.focus()}},onCheck:(v,y)=>{var N;if(!e.showCheckbox)return;const V=p("value",v),s={};treeEach([a.value.store.root],I=>s[I.key]=I,I=>I.childNodes);const A=y.checkedKeys,S=e.multiple?toValidArray(e.modelValue).filter(I=>!(I in s)&&!A.includes(I)):[],z=S.concat(A);if(e.checkStrictly)l(UPDATE_MODEL_EVENT,e.multiple?z:z.includes(V)?V:void 0);else if(e.multiple){const I=x();l(UPDATE_MODEL_EVENT,S.concat(I))}else{const I=treeFind([v],j=>!isValidArray(p("children",j))&&!p("disabled",j),j=>p("children",j)),L=I?p("value",I):void 0,q=isValidValue(e.modelValue)&&!!treeFind([v],j=>p("value",j)===e.modelValue,j=>p("children",j));l(UPDATE_MODEL_EVENT,L===e.modelValue||q?void 0:L)}nextTick(()=>{var I;const L=toValidArray(e.modelValue);a.value.setCheckedKeys(L),(I=o.onCheck)==null||I.call(o,v,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})}),(N=r.value)==null||N.focus()},onNodeExpand:(v,y,N)=>{var V;(V=o.onNodeExpand)==null||V.call(o,v,y,N),nextTick(()=>{if(!e.checkStrictly&&e.lazy&&e.multiple&&y.checked){const s={},A=a.value.getCheckedKeys();treeEach([a.value.store.root],I=>s[I.key]=I,I=>I.childNodes);const S=toValidArray(e.modelValue).filter(I=>!(I in s)&&!A.includes(I)),z=x();l(UPDATE_MODEL_EVENT,S.concat(z))}})},cacheOptions:u}};var CacheOptions=defineComponent({props:{data:{type:Array,default:()=>[]}},setup(e){const o=inject(selectKey);return watch(()=>e.data,()=>{var n;e.data.forEach(r=>{o.states.cachedOptions.has(r.value)||o.states.cachedOptions.set(r.value,r)});const l=((n=o.selectRef)==null?void 0:n.querySelectorAll("input"))||[];isClient&&!Array.from(l).includes(document.activeElement)&&o.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const _sfc_main$4=defineComponent({name:"ElTreeSelect",inheritAttrs:!1,props:{...ElSelect.props,...ElTree.props,cacheData:{type:Array,default:()=>[]}},setup(e,o){const{slots:n,expose:l}=o,r=ref(),a=ref(),c=computed(()=>e.nodeKey||e.valueKey||"value"),C=useSelect(e,o,{select:r,tree:a,key:c}),{cacheOptions:p,...k}=useTree(e,o,{select:r,tree:a,key:c}),u=reactive({});return l(u),onMounted(()=>{Object.assign(u,{...pick(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...pick(r.value,["focus","blur"])})}),()=>h(ElSelect,reactive({...C,ref:x=>r.value=x}),{...n,default:()=>[h(CacheOptions,{data:p.value}),h(ElTree,reactive({...k,ref:x=>a.value=x}))]})}});var TreeSelect=_export_sfc(_sfc_main$4,[["__file","tree-select.vue"]]);const ElTreeSelect=withInstall(TreeSelect),_hoisted_1$3={key:0,class:"mask-box"},_hoisted_2$3={flex:"","flex-row":"","flex-items-center":""},_hoisted_3$3={key:1,class:"mask-box show-mask"},_hoisted_4$3={key:2,class:"label"},_hoisted_5$2={key:3,flex:"","flex-row":"","flex-items-center":""},_sfc_main$3=defineComponent({__name:"DialogArgItem",props:{argItem:{type:Object,required:!0},edit:{type:Boolean,default:!1}},emits:["onEdit","onDelete"],setup(e,{emit:o}){useCssVars(k=>({"4b4157b4":unref(a),b824605c:unref(c)}));const n=o,l=k=>["switch","numberInput","numberRangeInput"].includes(k)?"row-item arg-item":"arg-item",r=["input","FileInput","DirInput","slider"],{appAsideBgColor:a}=useAppTheme(),c=computed(()=>(a.value==="#272727"?"#f6f6f6":"#272727")+"B0"),C=k=>{n("onEdit",k)},p=k=>{n("onDelete",k)};return(k,u)=>{var i,m,F,U;const x=ElTag,v=ElText,y=ElIcon,N=ElButton,V=ElButtonGroup,s=ElSelect,A=__unplugin_components_6$1,S=__unplugin_components_5,z=__unplugin_components_7,I=ElSwitch,L=__unplugin_components_10,q=ElInputNumber,j=ElInput,b=_sfc_main$8;return openBlock(),createElementBlock("div",{class:normalizeClass(l(e.argItem.componentType))},[e.edit?(openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$3,[createVNode(x,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.componentType),1)]),_:1}),createVNode(v,{class:"info"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.name),1)]),_:1})]),createVNode(V,null,{default:withCtx(()=>[createVNode(N,{onClick:u[0]||(u[0]=B=>C(e.argItem.id)),link:"",class:"btn",type:"primary"},{default:withCtx(()=>[createVNode(y,{class:"btn"},{default:withCtx(()=>u[11]||(u[11]=[createBaseVNode("span",{"i-mdi-playlist-edit":"",class:"btn"},null,-1)])),_:1})]),_:1}),createVNode(N,{type:"danger",onClick:u[1]||(u[1]=B=>p(e.argItem.id)),link:"",class:"btn"},{default:withCtx(()=>[createVNode(y,{class:"btn"},{default:withCtx(()=>u[12]||(u[12]=[createBaseVNode("span",{"i-mdi-delete-outline":"",class:"btn"},null,-1)])),_:1})]),_:1})]),_:1})])):(openBlock(),createElementBlock("div",_hoisted_3$3)),((i=e.argItem)==null?void 0:i.label)!==void 0&&!r.includes(e.argItem.componentType)&&e.edit?(openBlock(),createElementBlock("span",_hoisted_4$3,toDisplayString(e.argItem.label),1)):createCommentVNode("",!0),e.edit?(openBlock(),createElementBlock(Fragment,{key:4},[e.argItem&&e.argItem.componentType==="select"?(openBlock(),createBlock(s,{key:0,modelValue:e.argItem.value,"onUpdate:modelValue":u[2]||(u[2]=B=>e.argItem.value=B),filterable:"",multiple:e.argItem.multiple,clearable:e.argItem.multiple,"allow-create":!e.argItem.notAllowCreate,"default-first-option":"",placeholder:e.argItem.placeholder||"请选择"},null,8,["modelValue","multiple","clearable","allow-create","placeholder"])):e.argItem&&e.argItem.componentType==="FileInput"?(openBlock(),createBlock(A,{key:1,modelValue:e.argItem.value,"onUpdate:modelValue":u[3]||(u[3]=B=>e.argItem.value=B),label:e.argItem.label,verify:e.argItem.verifyPath,multiple:e.argItem.multiple},null,8,["modelValue","label","verify","multiple"])):e.argItem&&e.argItem.componentType==="RectInput"?(openBlock(),createBlock(S,{key:2,modelValue:e.argItem.value,"onUpdate:modelValue":u[4]||(u[4]=B=>e.argItem.value=B)},null,8,["modelValue"])):e.argItem&&e.argItem.componentType==="slider"?(openBlock(),createBlock(z,{key:3,modelValue:e.argItem.value,"onUpdate:modelValue":u[5]||(u[5]=B=>e.argItem.value=B),max:(m=e.argItem.range)==null?void 0:m.max,min:(F=e.argItem.range)==null?void 0:F.min,step:(U=e.argItem.range)==null?void 0:U.step,label:e.argItem.label,size:"small",width:100},null,8,["modelValue","max","min","step","label"])):e.argItem&&e.argItem.componentType==="switch"?(openBlock(),createBlock(I,{key:4,modelValue:e.argItem.value,"onUpdate:modelValue":u[6]||(u[6]=B=>e.argItem.value=B),"active-text":e.argItem.activeText||"是","inactive-text":e.argItem.inactiveText||"否",size:"small"},null,8,["modelValue","active-text","inactive-text"])):e.argItem&&e.argItem.componentType==="DirInput"?(openBlock(),createBlock(L,{key:5,modelValue:e.argItem.value,"onUpdate:modelValue":u[7]||(u[7]=B=>e.argItem.value=B),label:e.argItem.label,suffix:e.argItem.suffix||"",verify:e.argItem.verifyPath},null,8,["modelValue","label","suffix","verify"])):e.argItem&&e.argItem.componentType==="numberInput"?(openBlock(),createBlock(q,{key:6,modelValue:e.argItem.value,"onUpdate:modelValue":u[8]||(u[8]=B=>e.argItem.value=B),"value-on-clear":0,size:"small"},null,8,["modelValue"])):e.argItem&&e.argItem.componentType==="input"?(openBlock(),createBlock(j,{key:7,modelValue:e.argItem.value,"onUpdate:modelValue":u[9]||(u[9]=B=>e.argItem.value=B),size:"small"},{prepend:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.label),1)]),_:1},8,["modelValue"])):e.argItem&&e.argItem.componentType==="numberRangeInput"?(openBlock(),createBlock(b,{key:8,modelValue:e.argItem.value,"onUpdate:modelValue":u[10]||(u[10]=B=>e.argItem.value=B)},null,8,["modelValue"])):createCommentVNode("",!0)],64)):(openBlock(),createElementBlock("div",_hoisted_5$2,[createVNode(x,{type:"primary",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.componentType),1)]),_:1}),createVNode(v,null,{default:withCtx(()=>[createTextVNode(toDisplayString(e.argItem.label),1)]),_:1})]))],2)}}}),__unplugin_components_13$1=_export_sfc$1(_sfc_main$3,[["__scopeId","data-v-a68d7acc"]]),_hoisted_1$2={class:"dialog-form"},_hoisted_2$2={"w-full":"",flex:"","flex-row":"","pos-relative":"","h-85vh":"","position-relative":""},_hoisted_3$2={"overflow-y-scroll":"","overflow-x-hidden":"","p-3":"","box-border":"",class:"b1"},_hoisted_4$2={"flex-1":"","h-full":"","overflow-y-scroll":"","overflow-x-hidden":"","ml-1":"","p-3":"","box-border":"",class:"b1"},_sfc_main$2=defineComponent({__name:"DialogArgEditor",props:mergeModels({documentParams:{type:Array,default:[]}},{modelValue:{default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(__props){useCssVars(e=>({"373d42b4":unref(appAsideBgColor)}));const props=__props,editDialogForm=reactive({componentType:void 0,noTest:!1,onlyTest:!1,name:"",label:"",displayCondition:[],placeholder:"请输入",component:{select:{optionType:"array",options:[],fnOptionsStr:'(store) => {return ["a1","a2"]}',selectOptionSeparator:"",notAllowCreate:!1,multiple:!1,value:"",mValue:[]},fileInput:{verifyPath:!1,suffix:"",multiple:!1,value:"",mValue:[]},input:{value:""},rectInput:{value:{x:0,y:0,width:0,height:0},targetSrc:""},slider:{value:0,range:{min:0,max:100,step:1}},switch:{value:!1,activeText:"是",inactiveText:"否"},dirInput:{value:"",suffix:"",verifyPath:!1},numberInput:{value:0},numberRangeInput:{value:[0,100],limit:[0,100]}},dialog:{visible:!1,targetId:""}}),onOnlyTestChange=()=>{editDialogForm.onlyTest&&(editDialogForm.noTest=!1)},onNoTestChange=()=>{editDialogForm.noTest&&(editDialogForm.onlyTest=!1)},model=useModel(__props,"modelValue"),displayConditionOption=computed(()=>model.value.filter(e=>e.name!==editDialogForm.name).map(e=>({id:e.id,name:e.name,label:e.label}))),localArgs=[{componentType:"input",value:"",desc:"文本输入框"},{componentType:"RectInput",value:{x:0,y:0,width:0,height:0},targetSrc:"",desc:"矩形参数输入框"},{componentType:"slider",value:0,range:{min:0,max:100,step:1},desc:"滑块进度条"},{componentType:"switch",value:!1,activeText:"是",inactiveText:"否",desc:"切换按钮"},{componentType:"DirInput",value:"",suffix:"",verifyPath:!1,desc:"目录输入框"},{componentType:"numberInput",value:0,desc:"数字输入框"},{componentType:"numberRangeInput",value:[0,100],limit:[0,100],desc:"数字范围输入框"},{desc:"单选下拉框(字符串数组选项)",componentType:"select",value:"",options:[],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"单选下拉框(函数返回选项)",componentType:"select",value:"",options:e=>["Option1","Option2"],selectOptionSeparator:"",notAllowCreate:!0,multiple:!1},{desc:"多选下拉框",componentType:"select",value:[],options:[],selectOptionSeparator:"",notAllowCreate:!1,multiple:!0},{componentType:"FileInput",value:"",suffix:"",verifyPath:!1,desc:"单文件选择"},{componentType:"FileInput",value:[],suffix:"",verifyPath:!1,desc:"多文件选择",multiple:!0}].map(e=>({...e,id:nanoid(),onlyTest:!1,noTest:!1,name:"",label:e.desc||e.componentType,displayCondition:[],placeholder:""})),clone=e=>({...e,id:nanoid(),label:e.desc}),{appAsideBgColor}=useAppTheme(),parseFnStr=fnStr=>{try{const fn=eval(fnStr);return fn(useListStore())}catch(e){return[]}},editArg=e=>{var n;const o=(n=model.value)==null?void 0:n.find(l=>l.id===e);if(o){if(editDialogForm.componentType=o.componentType,editDialogForm.noTest=!!o.noTest,editDialogForm.onlyTest=!!o.onlyTest,editDialogForm.name=o.name,editDialogForm.label=o.label,editDialogForm.displayCondition=o.displayCondition||[],editDialogForm.placeholder=o.placeholder||"",o.componentType==="select"){const l=o,r=Array.isArray(l.options)?"array":"function";editDialogForm.component.select.optionType=r,Array.isArray(l.options)?editDialogForm.component.select.options=l.options.map(a=>""+a):editDialogForm.component.select.fnOptionsStr=l.options.toString(),editDialogForm.component.select.selectOptionSeparator=l.selectOptionSeparator||"",editDialogForm.component.select.notAllowCreate=!!l.notAllowCreate,editDialogForm.component.select.multiple=!!l.multiple,l.multiple?editDialogForm.component.select.mValue=l.value:editDialogForm.component.select.value=l.value}else if(o.componentType==="FileInput"){const l=o;editDialogForm.component.fileInput.verifyPath=!!l.verifyPath,editDialogForm.component.fileInput.suffix=l.suffix||"",editDialogForm.component.fileInput.multiple=!!l.multiple,l.multiple?editDialogForm.component.fileInput.mValue=l.value:editDialogForm.component.fileInput.value=l.value}else if(o.componentType==="input"){const l=o;editDialogForm.component.input.value=l.value}else if(o.componentType==="RectInput"){const l=o;editDialogForm.component.rectInput.value=l.value,editDialogForm.component.rectInput.targetSrc=l.targetSrc||""}else if(o.componentType==="slider"){const l=o;editDialogForm.component.slider.value=l.value,editDialogForm.component.slider.range=l.range}else if(o.componentType==="switch"){const l=o;editDialogForm.component.switch.value=l.value,editDialogForm.component.switch.activeText=l.activeText||"是",editDialogForm.component.switch.inactiveText=l.inactiveText||"否"}else if(o.componentType==="DirInput"){const l=o;editDialogForm.component.dirInput.value=l.value,editDialogForm.component.dirInput.suffix=l.suffix||"",editDialogForm.component.dirInput.verifyPath=!!l.verifyPath}else if(o.componentType==="numberInput"){const l=o;editDialogForm.component.numberInput.value=l.value}else if(o.componentType==="numberRangeInput"){const l=o;editDialogForm.component.numberRangeInput.value=l.value,editDialogForm.component.numberRangeInput.limit=l.limit||[0,0]}editDialogForm.dialog.targetId=e,editDialogForm.dialog.visible=!0}else ElMessage.error("编辑失败：未找到对应参数!")},editDialogCallback=()=>{var e;const target=(e=model.value)==null?void 0:e.find(o=>o.id===editDialogForm.dialog.targetId&&o.componentType===editDialogForm.componentType);if(target){if(target.componentType==="DirInput")target.suffix=editDialogForm.component.dirInput.suffix,target.verifyPath=editDialogForm.component.dirInput.verifyPath,target.value=editDialogForm.component.dirInput.value;else if(target.componentType==="FileInput"){if(editDialogForm.component.fileInput.multiple){const o=target;o.multiple=!0,o.value=editDialogForm.component.fileInput.mValue}else{const o=target;o.multiple=!1,o.value=editDialogForm.component.fileInput.value}target.suffix=editDialogForm.component.fileInput.suffix,target.verifyPath=editDialogForm.component.fileInput.verifyPath}else if(target.componentType==="input")target.value=editDialogForm.component.input.value;else if(target.componentType==="RectInput")target.value=editDialogForm.component.rectInput.value,target.targetSrc=editDialogForm.component.rectInput.targetSrc;else if(target.componentType==="slider")target.value=editDialogForm.component.slider.value,target.range=editDialogForm.component.slider.range;else if(target.componentType==="switch")target.value=editDialogForm.component.switch.value,target.activeText=editDialogForm.component.switch.activeText,target.inactiveText=editDialogForm.component.switch.inactiveText;else if(target.componentType==="numberInput")target.value=editDialogForm.component.numberInput.value;else if(target.componentType==="numberRangeInput")target.value=editDialogForm.component.numberRangeInput.value,target.limit=editDialogForm.component.numberRangeInput.limit;else{const{multiple}=editDialogForm.component.select;editDialogForm.component.select.optionType==="array"?target.options=editDialogForm.component.select.options:target.options=eval(editDialogForm.component.select.fnOptionsStr);const t=target;multiple?(t.value=editDialogForm.component.select.mValue,t.multiple=!0):(t.value=editDialogForm.component.select.value,t.multiple=!1),target.selectOptionSeparator=editDialogForm.component.select.selectOptionSeparator,target.notAllowCreate=editDialogForm.component.select.notAllowCreate}target.name=editDialogForm.name,target.label=editDialogForm.label,target.displayCondition=editDialogForm.displayCondition,target.placeholder=editDialogForm.placeholder,target.noTest=editDialogForm.noTest,target.onlyTest=editDialogForm.onlyTest,ElMessage.success("编辑成功")}else ElMessage.error("编辑失败：未找到对应参数!");editDialogForm.dialog.visible=!1},delArg=e=>{var o;model.value=(o=model.value)==null?void 0:o.filter(n=>n.id!==e),ElMessage.success("删除成功")};return(e,o)=>{const n=ElOption,l=ElSelect,r=ElInput,a=ElFormItem,c=ElSwitch,C=__unplugin_components_5,p=ElInputNumber,k=__unplugin_components_7,u=_sfc_main$8,x=ElForm,v=_sfc_main$9,y=ElText,N=ElDivider,V=__unplugin_components_13$1;return openBlock(),createElementBlock(Fragment,null,[createVNode(v,{callback:editDialogCallback,title:"修改参数",modelValue:unref(editDialogForm).dialog.visible,"onUpdate:modelValue":o[36]||(o[36]=s=>unref(editDialogForm).dialog.visible=s)},{element:withCtx(()=>[createBaseVNode("div",_hoisted_1$2,[createVNode(x,{"label-position":"left","label-width":"150px",model:unref(editDialogForm)},{default:withCtx(()=>[createVNode(a,{label:"字段命名",prop:"name"},{default:withCtx(()=>[props.documentParams.length?(openBlock(),createBlock(l,{key:0,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":o[0]||(o[0]=s=>unref(editDialogForm).name=s),filterable:"","allow-create":""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(props.documentParams,s=>(openBlock(),createBlock(n,{key:s.id,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(openBlock(),createBlock(r,{key:1,modelValue:unref(editDialogForm).name,"onUpdate:modelValue":o[1]||(o[1]=s=>unref(editDialogForm).name=s)},null,8,["modelValue"]))]),_:1}),createVNode(a,{label:"字段标签",prop:"label"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).label,"onUpdate:modelValue":o[2]||(o[2]=s=>unref(editDialogForm).label=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"不在API调试中使用",prop:"noTest"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).noTest,"onUpdate:modelValue":o[3]||(o[3]=s=>unref(editDialogForm).noTest=s),onChange:onNoTestChange},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"仅在API调试中使用",prop:"onlyTest"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).onlyTest,"onUpdate:modelValue":o[4]||(o[4]=s=>unref(editDialogForm).onlyTest=s),onChange:onOnlyTestChange},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"显示条件",prop:"displayCondition"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(editDialogForm).displayCondition,"onUpdate:modelValue":o[5]||(o[5]=s=>unref(editDialogForm).displayCondition=s),multiple:"",placeholder:"选择被依赖的字段，当被依赖字段值为true时本字段才显示"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(displayConditionOption),s=>(openBlock(),createBlock(n,{key:s.id,label:s.name+`(${s.label})`,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(a,{label:"输入提示",prop:"placeholder"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).placeholder,"onUpdate:modelValue":o[6]||(o[6]=s=>unref(editDialogForm).placeholder=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).componentType==="DirInput"?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(a,{label:"后缀",prop:"component.dirInput.suffix"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.dirInput.suffix,"onUpdate:modelValue":o[7]||(o[7]=s=>unref(editDialogForm).component.dirInput.suffix=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"验证路径",prop:"component.dirInput.verifyPath"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.dirInput.verifyPath,"onUpdate:modelValue":o[8]||(o[8]=s=>unref(editDialogForm).component.dirInput.verifyPath=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"默认值",prop:"component.dirInput.value"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.dirInput.value,"onUpdate:modelValue":o[9]||(o[9]=s=>unref(editDialogForm).component.dirInput.value=s)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="FileInput"?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(a,{label:"后缀",prop:"component.fileInput.suffix"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.fileInput.suffix,"onUpdate:modelValue":o[10]||(o[10]=s=>unref(editDialogForm).component.fileInput.suffix=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"验证路径",prop:"component.fileInput.verifyPath"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.fileInput.verifyPath,"onUpdate:modelValue":o[11]||(o[11]=s=>unref(editDialogForm).component.fileInput.verifyPath=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"是否多选",prop:"component.fileInput.multiple"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.fileInput.multiple,"onUpdate:modelValue":o[12]||(o[12]=s=>unref(editDialogForm).component.fileInput.multiple=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.fileInput.multiple?(openBlock(),createBlock(a,{key:0,label:"默认值",prop:"component.fileInput.mValue"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(editDialogForm).component.fileInput.mValue,"onUpdate:modelValue":o[13]||(o[13]=s=>unref(editDialogForm).component.fileInput.mValue=s),multiple:"","allow-create":"",filterable:""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(a,{key:1,label:"默认值",prop:"component.fileInput.value"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.fileInput.value,"onUpdate:modelValue":o[14]||(o[14]=s=>unref(editDialogForm).component.fileInput.value=s)},null,8,["modelValue"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="input"?(openBlock(),createBlock(a,{key:2,label:"默认值",prop:"component.input.value"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.input.value,"onUpdate:modelValue":o[15]||(o[15]=s=>unref(editDialogForm).component.input.value=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="RectInput"?(openBlock(),createElementBlock(Fragment,{key:3},[createVNode(a,{label:"目标图片路径",prop:"component.rectInput.targetSrc"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.rectInput.targetSrc,"onUpdate:modelValue":o[16]||(o[16]=s=>unref(editDialogForm).component.rectInput.targetSrc=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"默认值",prop:"component.rectInput.value"},{default:withCtx(()=>[createVNode(C,{modelValue:unref(editDialogForm).component.rectInput.value,"onUpdate:modelValue":o[17]||(o[17]=s=>unref(editDialogForm).component.rectInput.value=s)},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="select"?(openBlock(),createElementBlock(Fragment,{key:4},[createVNode(a,{label:"选项类型",prop:"component.select.optionType"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(editDialogForm).component.select.optionType,"onUpdate:modelValue":o[18]||(o[18]=s=>unref(editDialogForm).component.select.optionType=s)},{default:withCtx(()=>[createVNode(n,{label:"数组",value:"array"}),createVNode(n,{label:"函数",value:"function"})]),_:1},8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.optionType==="array"?(openBlock(),createBlock(a,{key:0,label:"选项",prop:"component.select.options"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(editDialogForm).component.select.options,"onUpdate:modelValue":o[19]||(o[19]=s=>unref(editDialogForm).component.select.options=s),multiple:"",filterable:"","allow-create":""},null,8,["modelValue"])]),_:1})):(openBlock(),createBlock(a,{key:1,label:"选项",prop:"component.select.fnOptionsStr"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.fnOptionsStr,"onUpdate:modelValue":o[20]||(o[20]=s=>unref(editDialogForm).component.select.fnOptionsStr=s)},null,8,["modelValue"])]),_:1})),createVNode(a,{label:"选项分隔符",prop:"component.select.selectOptionSeparator"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.select.selectOptionSeparator,"onUpdate:modelValue":o[21]||(o[21]=s=>unref(editDialogForm).component.select.selectOptionSeparator=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"是否多选",prop:"component.select.multiple"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.select.multiple,"onUpdate:modelValue":o[22]||(o[22]=s=>unref(editDialogForm).component.select.multiple=s)},null,8,["modelValue"])]),_:1}),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(a,{key:2,label:"不允许新建",prop:"component.select.notAllowCreate"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.select.notAllowCreate,"onUpdate:modelValue":o[23]||(o[23]=s=>unref(editDialogForm).component.select.notAllowCreate=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).component.select.multiple?(openBlock(),createBlock(a,{key:3,label:"默认值",prop:"component.select.mValue"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(editDialogForm).component.select.mValue,"onUpdate:modelValue":o[24]||(o[24]=s=>unref(editDialogForm).component.select.mValue=s),multiple:"","allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1})):(openBlock(),createBlock(a,{key:4,label:"默认值",prop:"component.select.value"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(editDialogForm).component.select.value,"onUpdate:modelValue":o[25]||(o[25]=s=>unref(editDialogForm).component.select.value=s),"allow-create":!unref(editDialogForm).component.select.notAllowCreate,filterable:""},{default:withCtx(()=>[unref(editDialogForm).component.select.optionType==="array"?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(editDialogForm).component.select.options,s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(parseFnStr(unref(editDialogForm).component.select.fnOptionsStr),s=>(openBlock(),createBlock(n,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue","allow-create"])]),_:1}))],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="slider"?(openBlock(),createElementBlock(Fragment,{key:5},[createVNode(a,{label:"最小值",prop:"component.slider.range.min"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.min,"onUpdate:modelValue":o[26]||(o[26]=s=>unref(editDialogForm).component.slider.range.min=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"最大值",prop:"component.slider.range.max"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.max,"onUpdate:modelValue":o[27]||(o[27]=s=>unref(editDialogForm).component.slider.range.max=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"步长",prop:"component.slider.range.step"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.slider.range.step,"onUpdate:modelValue":o[28]||(o[28]=s=>unref(editDialogForm).component.slider.range.step=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"默认值",prop:"component.slider.value"},{default:withCtx(()=>[createVNode(k,{modelValue:unref(editDialogForm).component.slider.value,"onUpdate:modelValue":o[29]||(o[29]=s=>unref(editDialogForm).component.slider.value=s),step:unref(editDialogForm).component.slider.range.step,min:unref(editDialogForm).component.slider.range.min,max:unref(editDialogForm).component.slider.range.max,width:100,label:"默认值","hide-label":""},null,8,["modelValue","step","min","max"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="switch"?(openBlock(),createElementBlock(Fragment,{key:6},[createVNode(a,{label:"开启文本",prop:"component.switch.activeText"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.switch.activeText,"onUpdate:modelValue":o[30]||(o[30]=s=>unref(editDialogForm).component.switch.activeText=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"关闭文本",prop:"component.switch.inactiveText"},{default:withCtx(()=>[createVNode(r,{modelValue:unref(editDialogForm).component.switch.inactiveText,"onUpdate:modelValue":o[31]||(o[31]=s=>unref(editDialogForm).component.switch.inactiveText=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"默认值",prop:"component.switch.value"},{default:withCtx(()=>[createVNode(c,{modelValue:unref(editDialogForm).component.switch.value,"onUpdate:modelValue":o[32]||(o[32]=s=>unref(editDialogForm).component.switch.value=s),"active-text":unref(editDialogForm).component.switch.activeText,"inactive-text":unref(editDialogForm).component.switch.inactiveText},null,8,["modelValue","active-text","inactive-text"])]),_:1})],64)):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberInput"?(openBlock(),createBlock(a,{key:7,label:"默认值",prop:"component.numberInput.value"},{default:withCtx(()=>[createVNode(p,{modelValue:unref(editDialogForm).component.numberInput.value,"onUpdate:modelValue":o[33]||(o[33]=s=>unref(editDialogForm).component.numberInput.value=s)},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0),unref(editDialogForm).componentType==="numberRangeInput"?(openBlock(),createElementBlock(Fragment,{key:8},[createVNode(a,{label:"范围限制",prop:"component.numberRangeInput.limit"},{default:withCtx(()=>[createVNode(u,{modelValue:unref(editDialogForm).component.numberRangeInput.limit,"onUpdate:modelValue":o[34]||(o[34]=s=>unref(editDialogForm).component.numberRangeInput.limit=s)},null,8,["modelValue"])]),_:1}),createVNode(a,{label:"默认值",prop:"component.numberRangeInput.value"},{default:withCtx(()=>[createVNode(u,{modelValue:unref(editDialogForm).component.numberRangeInput.value,"onUpdate:modelValue":o[35]||(o[35]=s=>unref(editDialogForm).component.numberRangeInput.value=s),limit:unref(editDialogForm).component.numberRangeInput.limit},null,8,["modelValue","limit"])]),_:1})],64)):createCommentVNode("",!0)]),_:1},8,["model"])])]),_:1},8,["modelValue"]),createBaseVNode("div",_hoisted_2$2,[createBaseVNode("div",_hoisted_3$2,[createVNode(y,null,{default:withCtx(()=>o[39]||(o[39]=[createTextVNode("预设组件")])),_:1}),createVNode(N),createVNode(unref(lo),{modelValue:unref(localArgs),"onUpdate:modelValue":o[37]||(o[37]=s=>isRef(localArgs)?localArgs.value=s:null),animation:150,group:{name:"args",pull:"clone",put:!1},ghostClass:"ghost",clone,sort:!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(localArgs),s=>(openBlock(),createBlock(V,{key:s.id,argItem:s},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_4$2,[createVNode(y,null,{default:withCtx(()=>o[40]||(o[40]=[createTextVNode("弹窗参数组件")])),_:1}),createVNode(N),createVNode(unref(lo),{"h-full":"","w-full":"",modelValue:model.value,"onUpdate:modelValue":o[38]||(o[38]=s=>model.value=s),animation:150,group:{name:"args"},ghostClass:"ghost",sort:!0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(model.value,s=>(openBlock(),createBlock(V,{key:s.id,argItem:s,edit:"",onOnEdit:editArg,onOnDelete:delArg},null,8,["argItem"]))),128))]),_:1},8,["modelValue"])])])],64)}}}),__unplugin_components_13=_export_sfc$1(_sfc_main$2,[["__scopeId","data-v-570c14f9"]]),defaultInvokeTemplateOptions=()=>({name:"",scope:"",weight:1,disabled:!1,document:{howToUse:"",params:[],returnValue:{instructions:"",type:"void"},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:{title:"",content:"",args:[],notOpen:!1}});class InvokeTemplate{constructor(e){te(this,"options");te(this,"contentCache",{});e.scope=e.scope||"",e.weight=e.weight||5,e.disabled=e.disabled!==void 0?e.disabled:!1,this.options=e}genParamList(){const e=this.options.document.params;return e?e.map(o=>{const n=Array.isArray(o.type)?o.type.map(l=>`"${l}"`).join(" | "):o.type;return o.default?`${o.name}: ${n} = ${o.type==="string"||Array.isArray(o.type)?`'${o.default}'`:o.default},`:n.trim().length?`${o.name}${o.required?"":"?"}: ${n},`:`${o.name},`}).join(`
  `):""}genArgList(){const e=this.options.dialog.args;if(e){const o=JSON.stringify(e,null,2),n=/"([^"]+)":/g;return o.replace(n,"$1:")}else return""}genCBOptionNames(){const e=this.options.dialog.args;return e?e.map(o=>o.name).join(", "):""}genCBOption(){const e=this.options.dialog.args;return e!=null&&e.length?`${e.map(o=>{let n="string";const l=["numberInput","numberRangeInput","slider"];return o.componentType==="switch"?n="boolean":o.componentType==="RectInput"?n=`{
      x: number;
      y: number;
      width: number;
      height: number;
    }`:l.includes(o.componentType)&&(n="number"),`${o.name}: ${n}`}).join(`;
    `)};
    `:""}defaultSnippet(){const{returnValue:e,params:o}=this.options.document;let n="";if(e!=null&&e.type){const l=e.type.toLocaleLowerCase();let r=0;e.type.toLocaleLowerCase()!=="promise<void>"&&e.type.toLocaleLowerCase()!=="void"&&e.type.toLocaleLowerCase()!=="undefined"&&(n="${1:const res = }",r++);const a=(o==null?void 0:o.map(c=>`\${${++r}:${Array.isArray(c.type)?c.type[0]:c.type==="string"?`'${c.name}'`:c.name}}`||"").join(", "))||"";n+=`${l.includes("promise")?"await ":""}${this.options.name}(${a});\${0:}`}return n}get indexTemplate(){return`import { apiDocument } from "./document";
import { ${this.options.name}Fn } from "./exportFn";
import { modelCallback } from "./modelCallback";
import { dialogOptions } from "./dialog";
import { declaration } from "./declaration";
import { auxiliary } from "./auxiliary";
export const ${this.options.name}Api = <InvokeApiMethodType>{
  ${this.options.scope.length?`scope: '${this.options.scope}',
  `:""}name: "${this.options.name}",
  exportFn: {
    fn: ${this.options.name}Fn,
  },
  testModule: {
    weight: ${this.options.weight},
    dialog: dialogOptions,
    callback: modelCallback,
    document: apiDocument,
  },
  //提供给编辑器的类型声明
  declaration,
  //编辑-快速填写或修改方法参数 辅助模块
  auxiliary${this.options.disabled?`,
  disabled: true`:""}
};`}genRetract(e,o=2){return" ".repeat(e*o)}genParamListStr(e,o=2){return`[${e?`
`+this.genRetract(o):""}${e?e.map(n=>`{
${this.genRetract(o+1)}name: "${n.name}",
${this.genRetract(o+1)}required: ${n.required?"true":"false"},
${this.genRetract(o+1)}instructions: "${n.instructions}",
${this.genRetract(o+1)}type: ${Array.isArray(n.type)?`[${n.type.map(l=>`'${l}'`).join(", ")}]`:`'${n.type}'`},
${this.genRetract(o+1)}default: "${n.type==="string"?`${n.default.includes('"')||n.default.includes("'")?`'${n.default}'`:n.default}`:n.default}",
${this.genRetract(o+1)}children: ${this.genParamListStr(n.children,o+2)}
${this.genRetract(o)}}`).join(`,
`+this.genRetract(o)):""}${e?`
`+this.genRetract(o-1):""}]`}get documentTemplate(){var e,o,n,l,r;const d=this.options.document,prefixStr="export const apiDocument = <ApiDocumentType>",tempStr=`{
  howToUse: "${d.howToUse}",
  params: ${this.genParamListStr(d.params)},
  returnValue: {
    ${(e=d==null?void 0:d.returnValue)!=null&&e.instructions?`instructions: "${d.returnValue.instructions}",
    `:""}type: \`${((o=d==null?void 0:d.returnValue)==null?void 0:o.type)||""}\`,
  },
  example: {
    ${(n=d==null?void 0:d.example)!=null&&n.title?`title: "${d.example.title.replace(/"/g,"'")}",`:'title: "",'}
    code: \`${((l=d==null?void 0:d.example)==null?void 0:l.code)||""}\`,
  },
  searchKeys: [${(r=d==null?void 0:d.searchKeys)==null?void 0:r.map(a=>`'${a}'`).join(", ")}],
  codeSnippet:
    "${(d==null?void 0:d.codeSnippet)||this.defaultSnippet()}",
};`;try{let res=JSON.stringify(eval(`const t = ${tempStr};t`),void 0,2);const regex=/"([^"]+)":/g;return res=res.replace(regex,"$1:"),`${prefixStr}${res}`}catch(a){return`${prefixStr}${tempStr}`}}get exportFnTemplate(){const e=this.options.name;return`export const ${e}Fn = async (
  ${this.genParamList()}
  taskId?: string
) => {
  const { notAllowedFnId } = useScriptRuntime();
  if (taskId && notAllowedFnId.value.includes(taskId)) {
    return false;
  }
  try {
    //TODO
  } catch (e) {
    console.error("${e}FnError: ", e);
  }
};`}get declaration(){var e;return`export const declaration = \`${this.options.scope.length?"":"declare "}function ${this.options.name}(
  ${this.genParamList()}
): ${((e=this.options.document.returnValue)==null?void 0:e.type)||"void"};
\`;`}get dialogTemplate(){const{title:e,notOpen:o,content:n,args:l}=this.options.dialog;return`export const dialogOptions = <TestModuleDialogType>{
  ${o?`notOpen: true,
  `:""}${e?`title: "${e}",
  `:""}targetMethodName: "${this.options.name}",
  ${n?`content: "${n}",
  `:""}args: ${l?this.genArgList():"[]"}
};`}get dialogCBTemplate(){var a;const{name:e,scope:o,document:n,dialog:l}=this.options,r=(a=n.example)==null?void 0:a.code.replace(/\(.*\)/,`(${this.genCBOptionNames()})`);return l.notOpen?`export const modelCallback = async (
  _options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  testModuleCtx.showDetails("此方法无法直接调用，请在脚本中使用！", "${o.length?`${o}.`:""}${e}");
};`:`import { auxiliary } from "./auxiliary";
import { ${e}Fn } from "./exportFn";
export const modelCallback = async (
  options: {
    ${this.genCBOption()}replaceCurFnArgs?: (targetArgs: string) => void;
  },
  testModuleCtx: {
    showDetails: ShowDetailsFn;
  }
) => {
  if (options.replaceCurFnArgs) {
    //快速填写或修改方法参数弹窗点击确定时
    auxiliary.parameterReplace(options);
    AutoTipUtils.apiAutoTip();
    return;
  }
  //测试调用时
  const { ${this.genCBOptionNames()} } = options;
  console.time("${e}耗时");
  const res = await ${e}Fn(${this.genCBOptionNames()});
  console.time("${e}耗时");
  const selfModule = getInvokeApiMethods().find((i) => i.name === "${e}"${o.length?` && i.scope === "${o}"`:""})?.testModule!;
  //修改示例代码
  selfModule.document!.example!.code = \`${r}\`;
  testModuleCtx.showDetails(JSON.stringify(res), "${o.length?`${o}.`:""}${e}");
};
`}get auxiliaryTemplate(){const{name:e,scope:o}=this.options;return`export const auxiliary = <AuxiliaryType>{
  //快速编辑/修改参数弹窗打开时触发
  onDialogOpen: async (_close,...args) => {
    //处理来自编辑器的参数
    const params = await AutoTipUtils.paramsProcess(...args);
    const selfModule = getInvokeApiMethods().find((i) => i.name === "${e}"${o.length?` && i.scope === "${o}"`:""});
    const dialog = selfModule!.testModule!.dialog;
    if (!dialog.args) {
      return;
    }
    //根据参数的位置给弹窗对应的组件进行回填赋值
    dialog.args.forEach((i, index) => {
      /**
       * 例如函数本身有5个参数，而弹窗只有两个参数，params为编辑器中输入的5个参数，
       * index为弹窗中的参数位置，i.value为弹窗中组件的值
       * @example:
      switch (index) {
        case 0:
          //第一个参数为RectInput组件的值，刚好是函数前四个参数，故赋值如下
          i.value = {
            x: +params[0] || 0,
            y: +params[1] || 0,
            width: +params[2] || 0,
            height: +params[3] || 0,
          };
          break;
        case 1:
          //第二个参数为FileInput组件的值，AutoTipUtils.pathStrReset用来处理路径字符串
          i.value = AutoTipUtils.pathStrReset(params[4] || "");
          break;
        default:
          break;
      }
      */
    });
  },
  /**
   * 参数处理方法, 快速填写/修改参数弹窗点击确定时，会将弹窗中组件的值传入options，
   * 并且提供一个replaceCurFnArgs方法用来替换编辑器中当前函数的参数
  */
  parameterReplace: (options: {
    ${this.genCBOption()}replaceCurFnArgs: (targetArgs: string) => void;
  }) => {
    //根据实际情况去替换编辑器中的参数
    options.replaceCurFnArgs(
        ""/*替换后的参数字符串*/
    );
  },
};
`}async create(){const{scope:e,name:o}=this.options;try{const n=await pathUtils.resolve(await pathUtils.getInstallDir(),"../../../src/invokes/"),l=await pathUtils.resolve(n,e.length?`${e}/${o}`:o),r=await pathUtils.join(l,"index.ts"),a=await pathUtils.join(l,"document.ts"),c=await pathUtils.join(l,"exportFn.ts"),C=await pathUtils.join(l,"dialog.ts"),p=await pathUtils.join(l,"auxiliary.ts"),k=await pathUtils.join(l,"declaration.ts"),u=await pathUtils.join(l,"modelCallback.ts");return await Promise.all([fsUtils.writeFile(r,this.indexTemplate),fsUtils.writeFile(a,this.documentTemplate),fsUtils.writeFile(c,this.exportFnTemplate),fsUtils.writeFile(C,this.dialogTemplate),fsUtils.writeFile(p,this.auxiliaryTemplate),fsUtils.writeFile(k,this.declaration),fsUtils.writeFile(u,this.dialogCBTemplate)]),!0}catch{return!1}}async syncOtherFileName(e,o){const n=this.options.name,l=new RegExp(`i\\.name\\s?={2,3}\\s?[\`"']${o}[\`"']`,"g");try{const r=await pathUtils.resolve(e,"../exportFn.ts");let a;this.contentCache[r]?a=this.contentCache[r]:a=await fsUtils.readFile(r);const c=a.replace(new RegExp(`${o}Fn`,"g"),n+"Fn"),C=await pathUtils.resolve(e,"../auxiliary.ts");let p;this.contentCache[C]?p=this.contentCache[C]:p=await fsUtils.readFile(C);const k=p.replace(l,`i.name === "${n}"`),u=await pathUtils.resolve(e,"../declaration.ts");let x;this.contentCache[u]?x=this.contentCache[u]:x=await fsUtils.readFile(u);const v=x.replace(new RegExp(`function ${o}`,"g"),`function ${n}`),y=await pathUtils.resolve(e,"../modelCallback.ts");let N;this.contentCache[y]?N=this.contentCache[y]:N=await fsUtils.readFile(y);let V=N.replace(new RegExp(`${o}Fn`,"g"),`${n}Fn`);V=V.replace(new RegExp(`${o}耗时`,"g"),`${n}耗时`),V=V.replace(l,`i.name === "${n}"`),V=V.replace(new RegExp(`"${o}"`,"g"),`"${n}"`),V=V.replace(new RegExp(`\\.${o}`,"g"),`.${n}`),V=V.replace(new RegExp(`${o}\\(`,"g"),`${n}(`);const s=await pathUtils.resolve(e,"../document.ts");let A;this.contentCache[s]?A=this.contentCache[s]:A=await fsUtils.readFile(s);const S=A.replace(new RegExp(`${o}\\(`,"g"),`${n}(`);await Promise.all([fsUtils.writeFile(r,c),fsUtils.writeFile(C,k),fsUtils.writeFile(u,v),fsUtils.writeFile(y,V),fsUtils.writeFile(s,S)]),this.contentCache[r]=a,this.contentCache[C]=p,this.contentCache[u]=x,this.contentCache[y]=N,this.contentCache[s]=A}catch(r){console.error("syncOtherFileName error:",r)}}async syncOtherFileScope(e,o){const n=this.options.scope,l=new RegExp(`i\\.scope\\s?={2,3}\\s?[\`"']${o}[\`"']`,"g"),r=`i.scope === "${n}"`;try{const a=await pathUtils.resolve(e,"../auxiliary.ts");let c;this.contentCache[a]?c=this.contentCache[a]:c=await fsUtils.readFile(a);const C=c.replace(l,r),p=await pathUtils.resolve(e,"../modelCallback.ts");let k;this.contentCache[p]?k=this.contentCache[p]:k=await fsUtils.readFile(p);let u=k.replace(l,`i.scope === "${n}"`);u=u.replace(new RegExp(`${o}\\.`,"g"),`${n}.`);const x=await pathUtils.resolve(e,"../document.ts");let v;this.contentCache[x]?v=this.contentCache[x]:v=await fsUtils.readFile(x);const y=v.replace(new RegExp(`${o}\\.`,"g"),`${n}.`),N=await pathUtils.resolve(e,"../declaration.ts");let V;this.contentCache[N]?V=this.contentCache[N]:V=await fsUtils.readFile(N);let s=V;this.options.scope.trim().length?s=V.replace(/declare /,""):s.includes("declare function")||(s=y.replace(/function /,"declare function ")),await Promise.all([fsUtils.writeFile(a,C),fsUtils.writeFile(p,u),fsUtils.writeFile(x,y),fsUtils.writeFile(N,s)]),this.contentCache[a]=c,this.contentCache[p]=k,this.contentCache[x]=v,this.contentCache[N]=V}catch(a){console.error("syncOtherFileScope error:",a)}}async applyIndexOptions(e,o){if(!await exists(e)){console.error(`文件${e}不存在`);return}let l;this.contentCache[e]?l=this.contentCache[e]:l=await fsUtils.readFile(e);const r={nameChanged:!1,scopeChanged:!1};let a=l;const c=await astWorker.parseInvokeApiConfig(l,o.name+"Api");return this.options.disabled&&(c.disabled===void 0?a=a.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',
  disabled: true,`):a=a.replace(/disabled:\s*false,/,"disabled: true,")),c.testModule.weight!==this.options.weight&&(a=a.replace(/weight:\s*\d+,/,`weight: ${this.options.weight},`)),this.options.name!==c.name&&(a=a.replace(/fn:\s*.*Fn,/,`fn: ${this.options.name}Fn,`),a=a.replace(/import\s+\{\s*.*Fn\s*\}\s+from\s+".\/exportFn";?/,`import { ${this.options.name}Fn } from "./exportFn";`),a=a.replace(/export const .*Api\s*=/,`export const ${this.options.name}Api =`),a=a.replace(/name:\s*['"`].*['"`],?/,`name: '${this.options.name}',`),r.nameChanged=!0,await this.syncOtherFileName(e,c.name)),this.options.scope!==c.scope&&(c.scope!==void 0?a=a.replace(/scope:\s*['"`].*['"`],?/,this.options.scope.trim().length?`scope: '${this.options.scope}',`:""):this.options.scope.trim().length&&(a=a.replace(/name:\s*['"`].*['"`],?/,`scope: '${this.options.scope}',
  name: '${this.options.name}',`)),r.scopeChanged=!0,await this.syncOtherFileScope(e,c.scope)),a=a.replace(/^\s*\n/gm,""),a!==l&&(await fsUtils.writeFile(e,a),this.contentCache[e]=a),r}async applyDocumentOptions(documentFilePath){const exist=await exists(documentFilePath);if(!exist){console.error(`文件${documentFilePath}不存在`);return}let oldDocumentContent;this.contentCache[documentFilePath]?oldDocumentContent=this.contentCache[documentFilePath]:oldDocumentContent=await fsUtils.readFile(documentFilePath);const oldCode=eval(`${oldDocumentContent.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);let newCode=eval(`${this.documentTemplate.replace("<ApiDocumentType>","").replace("export ","")};apiDocument`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(documentFilePath,this.documentTemplate),this.contentCache[documentFilePath]=this.documentTemplate)}async applyDialogOptions(dialogFilePath){const exist=await exists(dialogFilePath);if(!exist){console.error(`文件${dialogFilePath}不存在`);return}let oldDialogContent;this.contentCache[dialogFilePath]?oldDialogContent=this.contentCache[dialogFilePath]:oldDialogContent=await fsUtils.readFile(dialogFilePath);const oldCode=eval(`${oldDialogContent.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);let newCode=eval(`${this.dialogTemplate.replace("<TestModuleDialogType>","").replace("export ","")};dialogOptions`);JSON.stringify(oldCode)!==JSON.stringify(newCode)&&(await fsUtils.writeFile(dialogFilePath,this.dialogTemplate),this.contentCache[dialogFilePath]=this.dialogTemplate)}async apply(e,o){try{let n;o.scope?n=await pathUtils.resolve(e,"../../../"):n=await pathUtils.resolve(e,"../../");const l=await pathUtils.resolve(e,"../"),r=await pathUtils.resolve(n,`${this.options.scope.length?this.options.scope+"/":""}${this.options.name}`);if(await exists(await pathUtils.resolve(r,"index.ts")))return ElMessage.error(`${this.options.scope?this.options.scope+".":""}${this.options.name} 已存在,无法完成修改！`),!1;const c=await pathUtils.resolve(e,"../dialog.ts"),C=await pathUtils.resolve(e,"../document.ts"),p=await this.applyIndexOptions(e,o);if(await this.applyDocumentOptions(C),await this.applyDialogOptions(c),p!=null&&p.nameChanged||p!=null&&p.scopeChanged)if(await fsUtils.moveChildToNewDir(l,r))ElMessage.success("更新成功");else return console.error("更新失败",l,r,this.options.scope),ElMessage.error("更新失败"),!1;return!0}catch(n){return console.error("apply new options error:",n),!1}}}const _hoisted_1$1={"w-full":""},_hoisted_2$1={"w-full":"","box-border":"",flex:"","flex-col":""},_hoisted_3$1={class:"form-item"},_hoisted_4$1={class:"form-item"},_hoisted_5$1={class:"form-item"},_hoisted_6$1={flex:"","flex-row":"","flex-items-center":""},_hoisted_7$1={class:"form-item"},_hoisted_8={flex:"","flex-col":""},_hoisted_9={class:"form-item"},_hoisted_10={"i-mdi-chevron-down":""},_hoisted_11={"i-mdi-chevron-left":""},_hoisted_12={flex:"","flex-col":"","pl-5":"","box-border":"","mt-2":""},_hoisted_13={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_14={flex:"","flex-col":"","flex-items-start":"","mb-2":""},_hoisted_15={class:"value"},_hoisted_16={"w-full":"",flex:"","flex-row":"","flex-items-center":"","justify-center":""},_hoisted_17={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_18={"w-full":"","box-border":"","pl-2":""},_hoisted_19={class:"form-item","w-full":""},_hoisted_20={class:"value"},_hoisted_21={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_22={flex:"","flex-col":"","flex-items-start":"","mb-2":"","w-full":""},_hoisted_23={"w-full":"","box-border":"","pl-2":""},_hoisted_24={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_25={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","p-8px":""},_hoisted_26={flex:"","flex-row":"","flex-items-center":"","w-full":"","justify-between":"","pr-2":"","mb-2":"","box-border":""},_hoisted_27={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pr-2":""},_hoisted_28={flex:"","flex-col":""},_hoisted_29={class:"form-item"},_hoisted_30={"i-mdi-chevron-down":""},_hoisted_31={"i-mdi-chevron-left":""},_hoisted_32={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_hoisted_33={class:"form-item"},_hoisted_34={key:0},_hoisted_35={class:"form-item"},_hoisted_36={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_37={flex:"","flex-col":"","flex-items-start":"","w-full":"","box-border":"","pl-8px":""},_hoisted_38={class:"form-item"},_hoisted_39={"i-mdi-chevron-down":""},_hoisted_40={"i-mdi-chevron-left":""},_hoisted_41={flex:"","flex-col":"","pl-5":"","box-border":"","w-full":"","pr-2":""},_sfc_main$1=defineComponent({__name:"InvokesManagerForm",props:mergeModels({scopeList:{type:Array,required:!0},anchorModel:{type:String,default:"horizontal"},anchorIdPrefix:{type:String,required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:o}){const n=useModel(e,"modelValue"),l=reactive([{name:"auxiliary",title:"辅助代码",code:"",show:!1,path:""},{name:"fn",title:"API本体",code:"",show:!1,path:""},{name:"cb",title:"《快捷输入/修改参数弹窗》回调代码",code:"",show:!1,path:""}]),r=async()=>{let b="";p.value.find(K=>(K.label===n.value.name?b=K.fullPath:K.children&&K.children.find(W=>{W.label===n.value.name&&(b=W.fullPath)}),!!b));const i=await pathUtils.resolve(b,"../auxiliary.ts"),m=l.find(K=>K.name==="auxiliary"),F=l.find(K=>K.name==="fn"),U=l.find(K=>K.name==="cb");if(await exists(i)){const K=await fsUtils.readFile(i);m.code=K,m.path=i}else m.code="",m.path="";const B=await pathUtils.resolve(b,"../exportFn.ts");if(await exists(B)){const K=await fsUtils.readFile(B);F.code=K,F.path=B}else F.code="",F.path="";const H=await pathUtils.resolve(b,"../modelCallback.ts");if(await exists(H)){const K=await fsUtils.readFile(H);U.code=K,U.path=H}else U.code="",U.path=""};watch(n,r,{deep:!0});const a=computed(()=>n.value.document.params),c=e,C=ref("");watchEffect(()=>{var b;if(n.value.document,!((b=n.value.document.codeSnippet)!=null&&b.trim().length)){const i=new InvokeTemplate(n.value);C.value=i.defaultSnippet()}});const p=ref([]),k=ref(!0),u=ref(!0),x=()=>{var b;if((b=n.value)!=null&&b.scope){let i=n.value.scope;n.value.scope=i.charAt(0).toUpperCase()+i.slice(1)}},{getApiModules:v}=useCore(),y=async()=>{const b=await v(!1,!0,!0),{groupRecordToOptions:i,dataGrouping:m}=dataStructureUtils,F=i(m(b,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);p.value=F.map(U=>{var B;return{...U,enabled:!U.disabled,disabled:!1,children:(B=U.children)==null?void 0:B.map(H=>({...H,enabled:!H.disabled,disabled:!1}))}})};let N;onBeforeUnmount(()=>{N&&N()}),onMounted(async()=>{N=await listen("tauri://focus",b=>{b.windowLabel===getCurrent().label&&r()}),await y(),r()});const V=(b,i)=>{const m=dataStructureUtils.findByIdInTree(i,n.value.document.params);m&&(b?(m.type=m.type.split("|"),m.type.includes(m.default)||(m.default=m.type[0])):m.type=m.type.join("|"))},s=["string","number","boolean","object","array","function","null","undefined"],A=(b,i)=>{const m=b?s.filter(B=>B.toLocaleLowerCase().includes(b.toLocaleLowerCase())):s,F=`'${b}'`;m.includes(F)||m.push(F);const U=`Promise<${b}>`;!m.includes(U)&&!m.includes(U.toLocaleLowerCase())&&!b.toLocaleLowerCase().includes("promise")&&m.push(U),!s.includes(b)&&!m.includes(b)&&(!b.includes("'")||!b.includes('"'))&&m.push(b),i(m.map(B=>({value:B})))},S=b=>{if(b===void 0)n.value.document.params?n.value.document.params.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):n.value.document.params=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}];else{const i=dataStructureUtils.findByIdInTree(b,n.value.document.params);i&&(i.children?i.children.push({id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}):i.children=[{id:nanoid(),name:"",required:!1,instructions:"",type:"",default:""}])}},z=b=>{const i=dataStructureUtils.getTreeParentById(b,n.value.document.params);if(i){const m=i.findIndex(F=>F.id===b);if(m>0){if(!i[m].required&&i[m-1].required){ElMessage.warning("非必填参数不允许在必填参数之前");return}const F=i[m];i[m]=i[m-1],i[m-1]=F}}},I=b=>{const i=dataStructureUtils.getTreeParentById(b,n.value.document.params);if(i){const m=i.findIndex(F=>F.id===b);if(m<i.length-1){if(i[m].required&&!i[m+1].required){ElMessage.warning("必填参数不允许在非必填参数之后");return}const F=i[m];i[m]=i[m+1],i[m+1]=F}}},L=async b=>{if(b===void 0)try{await ElMessageBox.confirm("确定清空所有参数吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}),n.value.document.params=[],ElMessage.info("清空完成")}catch{}else try{await ElMessageBox.confirm("确定删除该参数吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"});const i=dataStructureUtils.getTreeParentById(b,n.value.document.params);i.splice(i.findIndex(m=>m.id===b),1),ElMessage.info("删除完成")}catch{}},q=(b,i)=>{i.required&&i.default!==""&&(i.default="");const m=dataStructureUtils.getTreeParentById(b,n.value.document.params);m&&m.sort((F,U)=>F.required===U.required?0:F.required?-1:1)};return o({codeSnippetPlaceholder:C,changeFormShow:b=>{switch(b){case 0:k.value=!0;break;case 1:u.value=!0;break;default:l[b-2].show=!0;break}}}),(b,i)=>{const m=ElText,F=ElInput,U=ElSwitch,B=ElOption,H=ElTag,K=ElSelect,W=ElInputNumber,J=ElIcon,D=ElButton,f=ElTableColumn,w=ElAutocomplete,$=ElCheckbox,O=ElTable,R=__unplugin_components_13,M=__unplugin_components_14;return openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2$1,[createBaseVNode("div",_hoisted_3$1,[createVNode(m,{tag:"b",id:c.anchorIdPrefix+"-api-name"},{default:withCtx(()=>i[19]||(i[19]=[createTextVNode("API名称")])),_:1},8,["id"]),createVNode(F,{modelValue:n.value.name,"onUpdate:modelValue":i[0]||(i[0]=g=>n.value.name=g),placeholder:"API名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_4$1,[createVNode(m,{tag:"b",id:c.anchorIdPrefix+"-api-state"},{default:withCtx(()=>i[20]||(i[20]=[createTextVNode("API状态")])),_:1},8,["id"]),createVNode(U,{modelValue:n.value.disabled,"onUpdate:modelValue":i[1]||(i[1]=g=>n.value.disabled=g),"active-text":"禁用","inactive-text":"启用",style:{"--el-switch-on-color":"#ff4949","--el-switch-off-color":"var(--el-color-primary)"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_5$1,[createVNode(m,{tag:"b",id:c.anchorIdPrefix+"-ns"},{default:withCtx(()=>i[21]||(i[21]=[createTextVNode("命名空间(namespace)")])),_:1},8,["id"]),createVNode(K,{modelValue:n.value.scope,"onUpdate:modelValue":i[2]||(i[2]=g=>n.value.scope=g),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"Root",style:{width:"240px"},onChange:x},{label:withCtx(({label:g})=>[createBaseVNode("div",_hoisted_6$1,[c.scopeList.find(_=>_.label===g)?createCommentVNode("",!0):(openBlock(),createBlock(H,{key:0,size:"small",type:"success","mr-1":""},{default:withCtx(()=>i[22]||(i[22]=[createTextVNode("new")])),_:1})),createVNode(m,null,{default:withCtx(()=>[createTextVNode(toDisplayString(g),1)]),_:2},1024)])]),default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.scopeList,(g,_)=>(openBlock(),createBlock(B,{key:_,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_7$1,[createVNode(m,{tag:"b",id:c.anchorIdPrefix+"-weight"},{default:withCtx(()=>i[23]||(i[23]=[createTextVNode("显示权重(越大默认排序越靠前)")])),_:1},8,["id"]),createVNode(W,{modelValue:n.value.weight,"onUpdate:modelValue":i[3]||(i[3]=g=>n.value.weight=g),min:0,placeholder:"显示权重"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_8,[createBaseVNode("div",_hoisted_9,[createVNode(m,{tag:"b",id:c.anchorIdPrefix+"-api-doc"},{default:withCtx(()=>i[24]||(i[24]=[createTextVNode("API文档")])),_:1},8,["id"]),createVNode(D,{link:"",onClick:i[4]||(i[4]=g=>k.value=!unref(k))},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_10,null,512),[[vShow,unref(k)]]),withDirectives(createBaseVNode("span",_hoisted_11,null,512),[[vShow,!unref(k)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_12,[createBaseVNode("div",_hoisted_13,[createVNode(m,{"self-start":"","mb-2":""},{default:withCtx(()=>i[25]||(i[25]=[createTextVNode("API使用介绍")])),_:1}),createVNode(F,{modelValue:n.value.document.howToUse,"onUpdate:modelValue":i[5]||(i[5]=g=>n.value.document.howToUse=g),type:"textarea",placeholder:"API使用介绍",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_14,[createVNode(m,{"self-start":"","mb-2":""},{default:withCtx(()=>i[26]||(i[26]=[createTextVNode("API参数")])),_:1}),createVNode(O,{data:n.value.document.params,"table-layout":"fixed","row-key":"id","default-expand-all":"",border:!0,"max-height":"75vh"},{default:withCtx(()=>[createVNode(f,{prop:"name",label:"参数名",fixed:"",width:"180"},{default:withCtx(g=>[createVNode(F,{modelValue:g.row.name,"onUpdate:modelValue":_=>g.row.name=_,placeholder:"参数名"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(f,{prop:"required",label:"必填",width:"70"},{default:withCtx(g=>[createVNode(U,{modelValue:g.row.required,"onUpdate:modelValue":_=>g.row.required=_,"active-text":"是","inactive-text":"否","inline-prompt":"",onChange:_=>q(g.row.id,g.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),createVNode(f,{prop:"instructions",label:"说明",width:"260"},{default:withCtx(g=>[createVNode(F,{modelValue:g.row.instructions,"onUpdate:modelValue":_=>g.row.instructions=_,type:"textarea",placeholder:"说明",size:"small",autosize:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),createVNode(f,{prop:"type",label:"类型",width:"200"},{default:withCtx(g=>[Array.isArray(g.row.type)?(openBlock(),createBlock(K,{key:0,multiple:"",modelValue:g.row.type,"onUpdate:modelValue":_=>g.row.type=_,filterable:"","allow-create":""},null,8,["modelValue","onUpdate:modelValue"])):(openBlock(),createBlock(w,{key:1,modelValue:g.row.type,"onUpdate:modelValue":_=>g.row.type=_,"fetch-suggestions":A,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:_})=>[createBaseVNode("div",_hoisted_15,toDisplayString(_.value),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])),createVNode($,{"ml-1":"",checked:Array.isArray(g.row.type),label:"枚举",size:"small",onChange:_=>V(_,g.row.id)},null,8,["checked","onChange"])]),_:1}),createVNode(f,{prop:"default",label:"默认值"},{default:withCtx(g=>[Array.isArray(g.row.type)?(openBlock(),createBlock(K,{key:0,modelValue:g.row.default,"onUpdate:modelValue":_=>g.row.default=_,size:"small",disabled:g.row.required,filterable:"","allow-create":"",clearable:""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(g.row.type,_=>(openBlock(),createBlock(B,{key:_,label:_,value:_},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])):(openBlock(),createBlock(F,{key:1,modelValue:g.row.default,"onUpdate:modelValue":_=>g.row.default=_,placeholder:"默认值",size:"small",disabled:g.row.required},null,8,["modelValue","onUpdate:modelValue","disabled"]))]),_:1}),createVNode(f,{fixed:"right",width:"100"},{header:withCtx(()=>[createVNode(D,{link:"",type:"danger",size:"large",onClick:i[6]||(i[6]=g=>L())},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>i[27]||(i[27]=[createBaseVNode("span",{"i-mdi-sort-variant-remove":""},null,-1)])),_:1})]),_:1}),createVNode(D,{link:"",type:"primary",size:"large",onClick:i[7]||(i[7]=g=>S())},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>i[28]||(i[28]=[createBaseVNode("span",{"i-mdi-playlist-plus":""},null,-1)])),_:1})]),_:1})]),default:withCtx(g=>[createBaseVNode("div",_hoisted_16,[createVNode(D,{link:"",class:"ml-1",type:"danger",onClick:_=>L(g.row.id)},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>i[29]||(i[29]=[createBaseVNode("span",{"i-mdi-close":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(D,{link:"",class:"ml-1",type:"primary",onClick:_=>S(g.row.id)},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>i[30]||(i[30]=[createBaseVNode("span",{"i-mdi-filter-variant-plus":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(D,{link:"",class:"ml-1",onClick:_=>z(g.row.id)},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>i[31]||(i[31]=[createBaseVNode("span",{"i-mdi-arrow-up-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"]),createVNode(D,{link:"",class:"ml-1",onClick:_=>I(g.row.id)},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>i[32]||(i[32]=[createBaseVNode("span",{"i-mdi-arrow-down-thin":""},null,-1)])),_:1})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),createBaseVNode("div",_hoisted_17,[createVNode(m,{"self-start":""},{default:withCtx(()=>i[33]||(i[33]=[createTextVNode("返回值")])),_:1}),createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[createVNode(m,null,{default:withCtx(()=>i[34]||(i[34]=[createTextVNode("类型")])),_:1}),createVNode(w,{modelValue:n.value.document.returnValue.type,"onUpdate:modelValue":i[8]||(i[8]=g=>n.value.document.returnValue.type=g),style:{width:"480px"},"fetch-suggestions":A,clearable:"",placeholder:"请输入类型名称"},{default:withCtx(({item:g})=>[createBaseVNode("div",_hoisted_20,toDisplayString(g.value),1)]),_:1},8,["modelValue"])]),createBaseVNode("div",_hoisted_21,[createVNode(m,{"self-start":"","mb-2":""},{default:withCtx(()=>i[35]||(i[35]=[createTextVNode("返回值说明")])),_:1}),createVNode(F,{modelValue:n.value.document.returnValue.instructions,"onUpdate:modelValue":i[9]||(i[9]=g=>n.value.document.returnValue.instructions=g),type:"textarea",placeholder:"返回值说明",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_22,[createVNode(m,{"self-start":""},{default:withCtx(()=>i[36]||(i[36]=[createTextVNode("示例")])),_:1}),createBaseVNode("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[createVNode(m,{"self-start":""},{default:withCtx(()=>i[37]||(i[37]=[createTextVNode("标题")])),_:1}),createVNode(F,{modelValue:n.value.document.example.title,"onUpdate:modelValue":i[10]||(i[10]=g=>n.value.document.example.title=g),type:"textarea",placeholder:"示例标题",autosize:""},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_25,[createVNode(m,{"self-start":""},{default:withCtx(()=>i[38]||(i[38]=[createTextVNode("代码")])),_:1}),createVNode(F,{modelValue:n.value.document.example.code,"onUpdate:modelValue":i[11]||(i[11]=g=>n.value.document.example.code=g),type:"textarea",placeholder:"示例代码",autosize:""},null,8,["modelValue"])])])]),createBaseVNode("div",_hoisted_26,[createVNode(m,null,{default:withCtx(()=>i[39]||(i[39]=[createTextVNode("搜索关键词")])),_:1}),createVNode(K,{multiple:"",filterable:"","allow-create":"",modelValue:n.value.document.searchKeys,"onUpdate:modelValue":i[12]||(i[12]=g=>n.value.document.searchKeys=g),style:{width:"480px"},placeholder:"可以添加搜索关键词"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_27,[createVNode(m,{"self-start":""},{default:withCtx(()=>i[40]||(i[40]=[createTextVNode("代码片段(不填按照下面提示的内容生成)")])),_:1}),createVNode(F,{modelValue:n.value.document.codeSnippet,"onUpdate:modelValue":i[13]||(i[13]=g=>n.value.document.codeSnippet=g),type:"textarea",placeholder:unref(C),autosize:""},null,8,["modelValue","placeholder"])])],512),[[vShow,unref(k)]])]),createBaseVNode("div",_hoisted_28,[createBaseVNode("div",_hoisted_29,[createVNode(m,{tag:"b",id:c.anchorIdPrefix+"-api-test"},{default:withCtx(()=>i[41]||(i[41]=[createTextVNode("测试弹窗/快速修改参数弹窗")])),_:1},8,["id"]),createVNode(D,{link:"",onClick:i[14]||(i[14]=g=>u.value=!unref(u))},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_30,null,512),[[vShow,unref(u)]]),withDirectives(createBaseVNode("span",_hoisted_31,null,512),[[vShow,!unref(u)]])]),_:1})]),_:1})]),withDirectives(createBaseVNode("div",_hoisted_32,[createBaseVNode("div",_hoisted_33,[createVNode(m,null,{default:withCtx(()=>i[42]||(i[42]=[createTextVNode("不启用[测试弹窗/快速修改参数弹窗]")])),_:1}),createVNode(U,{modelValue:n.value.dialog.notOpen,"onUpdate:modelValue":i[15]||(i[15]=g=>n.value.dialog.notOpen=g),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),n.value.dialog.notOpen?createCommentVNode("",!0):(openBlock(),createElementBlock("div",_hoisted_34,[createBaseVNode("div",_hoisted_35,[createVNode(m,null,{default:withCtx(()=>i[43]||(i[43]=[createTextVNode("在API测试窗口显示的名称")])),_:1}),createVNode(F,{modelValue:n.value.dialog.title,"onUpdate:modelValue":i[16]||(i[16]=g=>n.value.dialog.title=g),placeholder:"在API测试窗口显示的名称",style:{width:"240px"}},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_36,[createVNode(m,{"self-start":""},{default:withCtx(()=>i[44]||(i[44]=[createTextVNode("弹窗中显示的内容(用于对API进行介绍或者说明)")])),_:1}),createVNode(F,{modelValue:n.value.dialog.content,"onUpdate:modelValue":i[17]||(i[17]=g=>n.value.dialog.content=g),autosize:"",placeholder:"弹窗中显示的内容",type:"textarea"},null,8,["modelValue"])]),createBaseVNode("div",_hoisted_37,[createVNode(m,{"self-start":""},{default:withCtx(()=>i[45]||(i[45]=[createTextVNode("弹窗组件编辑(可从左侧将指定参数组件拖拽至右侧)")])),_:1}),createVNode(R,{modelValue:n.value.dialog.args,"onUpdate:modelValue":i[18]||(i[18]=g=>n.value.dialog.args=g),"document-params":unref(a)},null,8,["modelValue","document-params"])])]))],512),[[vShow,unref(u)]])]),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(l),g=>(openBlock(),createElementBlock("div",{flex:"","flex-col":"",key:g.name},[createBaseVNode("div",_hoisted_38,[createVNode(m,{tag:"b",id:c.anchorIdPrefix+"-"+g.name},{default:withCtx(()=>[createTextVNode(toDisplayString(g.title),1)]),_:2},1032,["id"]),createVNode(D,{link:"",onClick:_=>g.show=!g.show},{default:withCtx(()=>[createVNode(J,{size:"large"},{default:withCtx(()=>[withDirectives(createBaseVNode("span",_hoisted_39,null,512),[[vShow,g.show]]),withDirectives(createBaseVNode("span",_hoisted_40,null,512),[[vShow,!g.show]])]),_:2},1024)]),_:2},1032,["onClick"])]),withDirectives(createBaseVNode("div",_hoisted_41,[createVNode(M,{"raw-code":g.code,"file-path":g.path},null,8,["raw-code","file-path"])],512),[[vShow,g.show]])]))),128))])])}}}),__unplugin_components_6=_export_sfc$1(_sfc_main$1,[["__scopeId","data-v-571d3edf"]]),_hoisted_1={class:"container-root","w-full":"","h-full":"","pos-relative":"","p-0":"","box-border":"","overflow-hidden":"",flex:"","p-5px":"","flex-col":""},_hoisted_2={"h-40px":"",flex:"","flex-row":"","justify-between":"","flex-items-center":"","w-full":"","p-5px":"","box-border":"","border-rd-10px":""},_hoisted_3={flex:"","flex-row":"","justify-end":"","flex-items-center":""},_hoisted_4={flex:"","flex-items-center":"","flex-row":""},_hoisted_5=["onClick"],_hoisted_6={key:1,"w-120px":"","ml-5":"","flex-col":"","mt-10":""},_hoisted_7=["onClick"],_sfc_main=defineComponent({__name:"InvokesManager",setup(e){useCssVars(f=>({"3e6eb27f":unref(C)}));const o=ref(""),n=ref(),l=ref(),r=["管理API","创建API"],a=ref("管理API"),c=ref(null),{appBackground:C}=useAppTheme(),p=ref("");let k="";const u=ref({manager:defaultInvokeTemplateOptions(),create:defaultInvokeTemplateOptions()}),x=reactive([]);let v="";watch(p,()=>{var $,O,R;const f=S.value.map(M=>M.children?M.children:[M]).flat().map(M=>({...M,scope:M.scope?M.scope:""})).find(M=>M.id===p.value),w={name:(f==null?void 0:f.label)||"",scope:(f==null?void 0:f.scope)||"",weight:(($=f==null?void 0:f.testModule)==null?void 0:$.weight)||1,disabled:(f==null?void 0:f.disabled)||!1,document:((O=f==null?void 0:f.testModule)==null?void 0:O.document)||{howToUse:"",params:[],returnValue:{instructions:"",type:""},example:{title:"",code:""},searchKeys:[],codeSnippet:""},dialog:((R=f==null?void 0:f.testModule)==null?void 0:R.dialog)||{title:"",content:"",args:[]}};u.value.manager=w,v=(f==null?void 0:f.fullPath)||"",k=JSON.stringify(w),x.splice(0,x.length,{label:"Root",value:""},...S.value.filter(M=>M.children).map(M=>({label:M.children[0].scope||"Root",value:M.children[0].scope||""})))});const y=computed(()=>k!==JSON.stringify(u.value.manager)&&!!p.value.length),N=(f=!0)=>{u.value.manager=JSON.parse(k),f&&ElMessage.success("重置成功")},V=async()=>{const f=JSON.parse(k);await new InvokeTemplate(JSON.parse(k)).apply(v,f)&&(k=JSON.stringify(u.value.manager))},s=async()=>{try{await ElMessageBox.confirm("删除后无法恢复，请谨慎删除！",`删除${u.value.manager.scope}.${u.value.manager.name}`,{confirmButtonText:"删除",cancelButtonText:"取消",confirmButtonClass:"el-button--danger",type:"error"})}catch{return}try{const f=await pathUtils.resolve(v,"../"),w=await pathUtils.resolve(f,"../");await fsUtils.deleteDir(f,!0)?(await fsUtils.deleteDir(w,!1,!0),ElMessage.success("删除成功")):ElMessage.error("删除失败")}catch(f){console.error(f),ElMessage.error("删除失败")}},A=async f=>{var w;if(y.value){try{await ElMessageBox.confirm("是否保存当前修改？","提示",{confirmButtonText:"保存",cancelButtonText:"放弃更改",type:"warning"})}catch{N(!1),(w=f.srcElement)==null||w.click();return}V()}},S=ref([]),{getApiModules:z}=useCore(),I=f=>{S.value=f.map(w=>{var $,O,R,M,g,_,G,Z,P,X,ee,oe,ne,le,ae,re,ie,se,de,ce,ue,pe,me,fe,he,ge,ve,ye,Ce,we,xe;return{...w,enabled:!w.disabled,disabled:!1,testModule:{...w.testModule,document:{...($=w.testModule)==null?void 0:$.document,params:dataStructureUtils.genTreeArrNodeId(((R=(O=w.testModule)==null?void 0:O.document)==null?void 0:R.params)||[]),returnValue:{...(g=(M=w.testModule)==null?void 0:M.document)==null?void 0:g.returnValue,instructions:((Z=(G=(_=w.testModule)==null?void 0:_.document)==null?void 0:G.returnValue)==null?void 0:Z.instructions)||""},example:{...(X=(P=w.testModule)==null?void 0:P.document)==null?void 0:X.example,title:((ne=(oe=(ee=w.testModule)==null?void 0:ee.document)==null?void 0:oe.example)==null?void 0:ne.title)||"",code:((re=(ae=(le=w.testModule)==null?void 0:le.document)==null?void 0:ae.example)==null?void 0:re.code)||""},searchKeys:((se=(ie=w.testModule)==null?void 0:ie.document)==null?void 0:se.searchKeys)||[],codeSnippet:((ce=(de=w.testModule)==null?void 0:de.document)==null?void 0:ce.codeSnippet)||""},dialog:{...(ue=w.testModule)==null?void 0:ue.dialog,args:(fe=(me=(pe=w.testModule)==null?void 0:pe.dialog)==null?void 0:me.args)==null?void 0:fe.map(T=>{const Y=nanoid();return T.componentType==="DirInput"?{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1,suffix:T.suffix||"",verifyPath:T.verifyPath||!1}:T.componentType==="FileInput"?{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1,suffix:T.suffix||"",verifyPath:T.verifyPath||!1,multiple:T.multiple||!1,value:T.value||(T.multiple?[]:"")}:T.componentType==="RectInput"?{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1,targetSrc:T.targetSrc||""}:T.componentType==="select"?{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1,options:T.options||[],multiple:T.multiple||!1,value:T.value||(T.multiple?[]:""),selectOptionSeparator:T.selectOptionSeparator||"",notAllowCreate:T.notAllowCreate||!1}:T.componentType==="numberRangeInput"?{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1,limit:T.limit||[0,0]}:T.componentType==="switch"?{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1,activeText:T.activeText||"是",inactiveText:T.inactiveText||"否"}:T.componentType==="slider"?{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1,range:T.range||{max:1,min:0,step:.1}}:{...T,id:Y,noTest:T.noTest||!1,onlyTest:T.onlyTest||!1}}),notOpen:((ge=(he=w.testModule)==null?void 0:he.dialog)==null?void 0:ge.notOpen)||!1,title:((ye=(ve=w.testModule)==null?void 0:ve.dialog)==null?void 0:ye.title)||"",content:((we=(Ce=w.testModule)==null?void 0:Ce.dialog)==null?void 0:we.content)||""}},children:(xe=w.children)==null?void 0:xe.map(T=>{var Y,Ne,ke,Ve,be,Te,De,Fe,Ee,_e,Be,Ie,$e,Se,Ae,Ue,Oe,Me,Ke,Pe,Le,Re,ze,je,qe,He,Je,Ye,We,Ge;return{...T,enabled:!T.disabled,disabled:!1,testModule:{...T.testModule,document:{...(Y=T.testModule)==null?void 0:Y.document,params:dataStructureUtils.genTreeArrNodeId(((ke=(Ne=T.testModule)==null?void 0:Ne.document)==null?void 0:ke.params)||[]),returnValue:{...(be=(Ve=T.testModule)==null?void 0:Ve.document)==null?void 0:be.returnValue,instructions:((Fe=(De=(Te=T.testModule)==null?void 0:Te.document)==null?void 0:De.returnValue)==null?void 0:Fe.instructions)||""},example:{...(_e=(Ee=T.testModule)==null?void 0:Ee.document)==null?void 0:_e.example,title:(($e=(Ie=(Be=T.testModule)==null?void 0:Be.document)==null?void 0:Ie.example)==null?void 0:$e.title)||"",code:((Ue=(Ae=(Se=T.testModule)==null?void 0:Se.document)==null?void 0:Ae.example)==null?void 0:Ue.code)||""},searchKeys:((Me=(Oe=T.testModule)==null?void 0:Oe.document)==null?void 0:Me.searchKeys)||[],codeSnippet:((Pe=(Ke=T.testModule)==null?void 0:Ke.document)==null?void 0:Pe.codeSnippet)||""},dialog:{...(Le=T.testModule)==null?void 0:Le.dialog,args:(je=(ze=(Re=T.testModule)==null?void 0:Re.dialog)==null?void 0:ze.args)==null?void 0:je.map(E=>{const Q=nanoid();return E.componentType==="DirInput"?{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1,suffix:E.suffix||"",verifyPath:E.verifyPath||!1}:E.componentType==="FileInput"?{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1,suffix:E.suffix||"",verifyPath:E.verifyPath||!1,multiple:E.multiple||!1,value:E.value||(E.multiple?[]:"")}:E.componentType==="RectInput"?{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1,targetSrc:E.targetSrc||""}:E.componentType==="select"?{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1,options:E.options||[],multiple:E.multiple||!1,value:E.value||(E.multiple?[]:""),selectOptionSeparator:E.selectOptionSeparator||"",notAllowCreate:E.notAllowCreate||!1}:E.componentType==="numberRangeInput"?{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1,limit:E.limit||[0,0]}:E.componentType==="switch"?{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1,activeText:E.activeText||"是",inactiveText:E.inactiveText||"否"}:E.componentType==="slider"?{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1,range:E.range||{max:1,min:0,step:.1}}:{...E,id:Q,noTest:E.noTest||!1,onlyTest:E.onlyTest||!1}}),notOpen:((He=(qe=T.testModule)==null?void 0:qe.dialog)==null?void 0:He.notOpen)||!1,title:((Ye=(Je=T.testModule)==null?void 0:Je.dialog)==null?void 0:Ye.title)||"",content:((Ge=(We=T.testModule)==null?void 0:We.dialog)==null?void 0:Ge.content)||""}}}})}}),S.value[0]&&(S.value[0].children&&S.value[0].children[0]?p.value=S.value[0].children[0].id:p.value=S.value[0].id)},L=async()=>{const f=JSON.parse(JSON.stringify(await z(!1,!0,!0))),{groupRecordToOptions:w,dataGrouping:$}=dataStructureUtils,O=w($(f,"scope"),"name","id",["disabled","id","fullPath","scope","testModule"]);I(O)},q=ref("horizontal"),j=async()=>{await appWindow.isMaximized()?q.value="vertical":q.value="horizontal"},b=reactive([{value:"api-name",label:"名称"},{value:"api-state",label:"状态"},{value:"ns",label:"命名空间"},{value:"weight",label:"权重"},{value:"api-doc",label:"文档"},{value:"api-test",label:"弹窗"},{value:"auxiliary",label:"辅助代码"},{value:"fn",label:"API本体"},{value:"cb",label:"回调代码"}]),i=f=>{const w=document.getElementById((a.value==="管理API"?"manager":"create")+"-"+f);if(w){const O=b.slice(-5).map(R=>R.value).indexOf(f);if(O!==-1){let R;a.value==="创建API"?R=n.value.changeFormShow:R=l.value.changeFormShow,R&&R(O)}nextTick(()=>{w.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})})}};let m={manager:b[0].value,create:b[0].value};watch(o,f=>{a.value==="管理API"?m.manager=f:m.create=f});const F=()=>{a.value==="创建API"?(o.value=m.create,setTimeout(()=>{i(m.create)},100)):(o.value=m.manager,setTimeout(()=>{i(m.manager)},100))};let U,B=!1,H=0;const K=f=>{U&&clearTimeout(U),U=setTimeout(()=>{const w=f.target.scrollTop||0,$=b.find(O=>{const R=document.getElementById((a.value==="管理API"?"manager":"create")+"-"+O.value);if(R){const M=R.getBoundingClientRect();return M.top>=70&&M.bottom<=window.innerHeight}return!1});if($)o.value=$.value,B=!1;else if(w<H){const O=b.findIndex(R=>R.value===o.value);O>0&&!B&&(o.value=b[O-1].value,B=!0)}H=w})};onMounted(async()=>{var f;await L(),j(),window.addEventListener("resize",j),(f=c.value)==null||f.addEventListener("scroll",K),o.value=b[0].value,invokeBaseApi.closeSplashscreen()}),onUnmounted(()=>{var f;window.removeEventListener("resize",j),(f=c.value)==null||f.removeEventListener("scroll",K)});const W=(f,w)=>{var R,M,g,_,G,Z;const $=(R=w.testModule)==null?void 0:R.dialog,O=(M=w.testModule)==null?void 0:M.document;return w.label.toLocaleLowerCase().includes(f.toLocaleLowerCase())||((g=$==null?void 0:$.title)==null?void 0:g.toLocaleLowerCase().includes(f.toLocaleLowerCase()))||((_=$==null?void 0:$.content)==null?void 0:_.toLocaleLowerCase().includes(f.toLocaleLowerCase()))||((G=O==null?void 0:O.howToUse)==null?void 0:G.toLocaleLowerCase().includes(f.toLocaleLowerCase()))||((Z=O==null?void 0:O.searchKeys)==null?void 0:Z.some(P=>P.toLocaleLowerCase().includes(f.toLocaleLowerCase())))},J=async()=>{try{await ElMessageBox.confirm("是否清空当前内容？","提示",{confirmButtonText:"清空",cancelButtonText:"取消",type:"warning"})}catch{return}u.value.create=defaultInvokeTemplateOptions(),ElMessage.success("清空完成")},D=()=>{var $;const{codeSnippetPlaceholder:f}=n.value;($=u.value.create.document.codeSnippet)!=null&&$.trim().length||(u.value.create.document.codeSnippet=f),new InvokeTemplate(u.value.create).create(),ElMessage.success("创建成功")};return(f,w)=>{const $=ElSegmented,O=ElText,R=ElTag,M=ElTreeSelect,g=ElButton,_=ElButtonGroup,G=__unplugin_components_6,Z=ElEmpty;return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode($,{modelValue:unref(a),"onUpdate:modelValue":w[0]||(w[0]=P=>isRef(a)?a.value=P:null),options:r,"ml-1":"",onChange:F},null,8,["modelValue"]),createBaseVNode("div",_hoisted_3,[withDirectives(createVNode(O,{tag:"b"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(y)?"*":""),1)]),_:1},512),[[vShow,unref(a)==="管理API"]]),withDirectives(createVNode(M,{size:"small",onClick:A,"w-300px":"","mr-10px":"",modelValue:unref(p),"onUpdate:modelValue":w[1]||(w[1]=P=>isRef(p)?p.value=P:null),data:unref(S),"filter-node-method":W,clearable:"",placeholder:"请选择API",filterable:"","default-expand-all":""},{default:withCtx(({data:{label:P,children:X,enabled:ee}})=>[createBaseVNode("div",_hoisted_4,[createTextVNode(toDisplayString(P),1),X?(openBlock(),createBlock(R,{key:0,"ml-1":"",size:"small"},{default:withCtx(()=>w[6]||(w[6]=[createTextVNode("namespace")])),_:1})):createCommentVNode("",!0),ee?createCommentVNode("",!0):(openBlock(),createBlock(R,{key:1,size:"small",type:"danger","ml-1":""},{default:withCtx(()=>w[7]||(w[7]=[createTextVNode("已禁用")])),_:1}))])]),_:1},8,["modelValue","data"]),[[vShow,unref(a)==="管理API"]]),withDirectives(createVNode(_,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(g,{type:"danger",onClick:s},{default:withCtx(()=>w[8]||(w[8]=[createTextVNode("删除API")])),_:1}),createVNode(g,{onClick:w[2]||(w[2]=P=>N(!0)),disabled:!unref(y)},{default:withCtx(()=>w[9]||(w[9]=[createTextVNode("恢复修改前")])),_:1},8,["disabled"]),createVNode(g,{type:"primary",onClick:V,disabled:!unref(y)},{default:withCtx(()=>w[10]||(w[10]=[createTextVNode("保存修改")])),_:1},8,["disabled"])]),_:1},512),[[vShow,unref(a)==="管理API"]]),withDirectives(createVNode(_,{"ml-1":"",size:"small"},{default:withCtx(()=>[createVNode(g,{onClick:J},{default:withCtx(()=>w[11]||(w[11]=[createTextVNode("清空内容")])),_:1}),createVNode(g,{type:"primary",onClick:D},{default:withCtx(()=>w[12]||(w[12]=[createTextVNode("保存新建")])),_:1})]),_:1},512),[[vShow,unref(a)==="创建API"]])])]),createBaseVNode("div",{flex:"","w-full":"",class:"content-container",style:normalizeStyle({flexDirection:unref(q)==="horizontal"?"column":"row"})},[unref(q)==="horizontal"?(openBlock(),createBlock($,{key:0,modelValue:unref(o),"onUpdate:modelValue":w[3]||(w[3]=P=>isRef(o)?o.value=P:null),options:unref(b),size:"small",block:!0},{default:withCtx(({item:P})=>[typeof P=="object"?(openBlock(),createElementBlock("div",{key:0,onClick:X=>i(P.value)},toDisplayString(P.label),9,_hoisted_5)):createCommentVNode("",!0)]),_:1},8,["modelValue","options"])):createCommentVNode("",!0),createBaseVNode("div",{"overflow-y-scroll":"","overflow-x-hidden":"",ref_key:"scrollRef",ref:c,"flex-1":""},[withDirectives(createVNode(G,{ref_key:"IMFRef_manager",ref:l,modelValue:unref(u).manager,"onUpdate:modelValue":w[4]||(w[4]=P=>unref(u).manager=P),"scope-list":unref(x),"anchor-model":unref(q),"anchor-id-prefix":"manager"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(a)==="管理API"&&unref(p)]]),withDirectives(createVNode(Z,{description:"请选择一个API进行管理"},null,512),[[vShow,unref(a)==="管理API"&&!unref(p)]]),withDirectives(createVNode(G,{ref_key:"IMFRef",ref:n,modelValue:unref(u).create,"onUpdate:modelValue":w[5]||(w[5]=P=>unref(u).create=P),"scope-list":unref(x),"anchor-model":unref(q),"anchor-id-prefix":"create"},null,8,["modelValue","scope-list","anchor-model"]),[[vShow,unref(a)==="创建API"]])],512),unref(q)==="vertical"?(openBlock(),createElementBlock("div",_hoisted_6,[createVNode(O,{tag:"b"},{default:withCtx(()=>w[13]||(w[13]=[createTextVNode("表单项")])),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(b),P=>(openBlock(),createElementBlock("div",{class:normalizeClass(["link-item",{active:unref(o)===P.value}]),onClick:X=>i(P.value),link:"",key:P.value},toDisplayString(P.label),11,_hoisted_7))),128))])):createCommentVNode("",!0)],4)])}}}),InvokesManager=_export_sfc$1(_sfc_main,[["__scopeId","data-v-85220140"]]);export{InvokesManager as default};
